* +--- OS3906A --------- MDFECHA -------------------------------------+
* |                                                                   |
* | NOMBRE ....... MDFECHA                                            |
* |                                                                   |
* | UBICACION .... SYST.LINKLIB    (RENT) AMODE(ANY) RMODE(24)        |
* |                                                                   |
* | AUTOR ........ ANGEL LUIS DOMINGUEZ MARTIN. (C) 1992              |
* |                                                                   |
* | FUNCIONES .... MODULO DE TRATAMIENTO, VERIFICACION Y CONVERSION   |
* |                DE FECHAS, OBTENCION DE FECHA/HORA DEL DIA,        |
* |                EDICION DE FECHA EN VARIOS FORMATOS Y DIA DE LA    |
* |                SEMANA.                                            |
* |                                                                   |
* | OBJETIVOS .... LIBERAR A PROGRAMAS DEL TTO. DE FECHAS             |
* |                                                                   |
* | LENGUAJE ..... ASSEMBLER H.                                       |
* |                                                                   |
* | TIPO ......... MODULO                                             |
* |                                                                   |
* | PARAMETROS ... AREA PASADA POR EL PROGRAMA LLAMANTE               |
* |                VER LA DSECT $PARAM AL FINAL DEL FUENTE            |
* |                                                                   |
* | COD.LLAMADA    POSITIVOS:  FUNCIONES A REALIZAR                   |
* |                NEGATIVOS:  ERRORES O FECHAS INVALIDAS             |
* |                                                                   |
* +-------------------------------------------------------------------+
* |     CONSIDERACIONES SOBRE EL CONCEPTO DE FECHA-BASE               |
* +-------------------------------------------------------------------+
* |                                                                   |
* | --> SE ENTIENDE POR FECHA-BASE LOS DIAS TRANSCURRIDOS DESDE EL    |
* |     1 DE ENERO DEL A¾O 1. ESO SUPONE UN NUMERO SECUENCIAL, QUE    |
* |     EN LA ACTUALIDAD ES DEL ORDEN DE                              |
* |                                                                   |
* |        01-01-0001 -  LUN -         1                              |
* |                                                                   |
* |        31-12-1992 -  JUE -   727.563                              |
* |        31-12-1993 -  VIE -   727.928                              |
* |        31-12-1994 -  SAB -   728.293                              |
* |        31-12-1995 -  DOM -   727.658                              |
* |        31-12-1996 -  MAR -   729.024                              |
* |        31-12-1997 -  MIE -   729.389                              |
* |        31-12-1998 -  JUE -   729.754                              |
* |        31-12-1999 -  VIE -   730.119                              |
* |        31-12-2000 -  DOM -   730.485                              |
* |                                                                   |
* |        31-12-9999  - VIE - 3.652.059  (HEX 37B9DB)                |
* |                                                                   |
* |        24-03-22967 - MIE - 8.388.607  (HEX 7FFFFF)                |
* |                                                                   |
* | --> DE ESTO SE DESPRENDE QUE CON UN CAMPO HEXADECIMAL DE TRES     |
* |     POSICIONES, BINARIAMENTE POSITIVO, PORDRIAN REPRESENTARSE     |
* |     TODAS LAS FECHAS ENTRE EL 01-ENE-0001 Y 24-03-22967, LO QUE   |
* |     PARECE SUFICIENTE INFORMATICAMENTE HABLANDO. UN CAMPO BINARIO |
* |     POSITIVO DE DOS POSICIONES SERIA INSUFICIENTE DE FORMA GLOBAL,|
* |     YA QUE SOLO PODRIA CONTENER EL VALOR 32760, LO QUE VALDRIA    |
* |     PARA UN PERIODO DE UNOS NOVENTA A¾OS. QUIZA PARA CIERTAS      |
* |     APLICACIONES, TOMANDO COMO FECHA DE ARRANQUE UNA DETERMINADA, |
* |     PODRIA SERVIR. POR EJEMPLO, CIERTAS APLICACIONES DE TIPO PC   |
* |     PARTEN DEL 01-01-1980, CON LO QUE, POR DIFERENCIA, SE PODRIAN |
* |     TENER FECHAS-BASE, EN MEDIA PALABRA, HASTA EL A¾O 2174 APROX. |
* |                                                                   |
* +-------------------------------------------------------------------+
* | FORMULA DE CALCULO DE FECHA-BASE A PARTIR DE UNA JULIANA AAAA/DDD |
* +-------------------------------------------------------------------+
* |                                                                   |
* | SIENDO   D = DIA                                                  |
* |          T = ANO - 1                                              |
* |                                                                   |
* | FECHA-BASE = D + (T*365) + (T/4) - (T/100) + (T/400)              |
* |                                                                   |
* +---------------------------------------  DOMINGUEZ (C) 1992 -------+
MDFECHA  INICIO    (12,11,10),COMEN='MODULO DE TTO. DE FECHAS.',       X
               VERSION=OS3906A,                                        X
               TIPO=RENT,                                              X
               PDIN=@DATA,                                             X
               FDIN=@DATAL,                                            X
               AMODE=ANY,                                              X
               RMODE=24,                                               X
               AUTH=NO,                                                X
               LOC=BELOW,                                              X
               CAPPING=SI,                                             X
               EQUREG=SI,                                              X
               ERRGET=ALERROR
         B     CMDSTART
ALERROR  EQU   *
         ABEND 77,DUMP
         FIN   CR,TIPO=ERRGET
CMDSTART EQU   *
*        +-----------------------------------+
*>>>>>>>>| CAMBIO DE ESTADO SI ES NECESARIO  |
*        | PARA EJECUTAR SIEMPRE EN AMODE 31 |
*        +-----------------------------------+
         LA    R1,*+4+4+2
         O     R1,KBSM
         BSM   R0,R1
*
*        +--------------------------+
*>>>>>>>>|   PROCESO DEL PROGRAMA   |
*        +--------------------------+
         L     R2,0(,R2)
         USING $PARAM,R2
*
         MVC   @TIME(TIMEL),TIME
         TIME  DEC,@TIMEDAT,LINKAGE=SYSTEM,MF=(E,@TIME),               X
               DATETYPE=YYYYMMDD
*
         UNPK  @HIPL(9),@TIMEDAT(5)     OBTENER HORA DE IPL
         UNPK  @FIPL(9),@TIMEDAT+8(5)   OBTENER FECHA IPL GREGORIANA
         MVC   @CENTURY,@FIPL        <> ALMACENAR CENTURIA ACTUAL
*
         LA    R1,TBPETIC
PR10     EQU   *
         CLI   0(R1),C'*'            <> FIN DE TABLA
         BE    PR10A
         CLC   $CODIGO,0(R1)         <> LOCALIZAR PETICION
         BE    PR10A
         A     R1,TBPETICL           <> AVANCE DE TABLA
         B     PR10
PR10A    L     R1,4(,R1)             <> DIRECCIONAR RUTINA
         BR    R1                    <> BIFURCAR A ELLA
*
PERR     MVI   $CODIGO,X'FF'
         MVI   $CODIGO+1,X'FF'       <> RET. -1 LLAMADA INVALIDA
         MVI   @WORKF,X'FF'
         MVC   @WORKF+1(L'@WORKF-1),@WORKF
         L     R15,@WORKF
         B     ENDOFPGM
*        +-----------------------------------------+----------+
*>>>>>>>>|   OBTENCION DE LA FECHA DEL DIA         | PE00     |<<<<<<<<
*        +-----------------------------------------+----------+
PE00     EQU   *
         MVC   $FEGREGO,@FIPL
         BAL   R9,RTGJ        CONVERTIR GREGORIANA A JULIANA
         BAL   R9,RTJB        CONVERTIR JULIANA A FECHA BASE
         BAL   R9,RTLI        OBTENER LITERALES
         SLR   R15,R15
         XC    $CODIGO,$CODIGO
         B     ENDOFPGM       DEVOLVER CONTROL
*        +-----------------------------------------+----------+
*>>>>>>>>|   VERIFICACION/CONVERSION DE JULIANA    | PE01     |<<<<<<<<
*        +-----------------------------------------+----------+
         CLC   $FEJULIA(2),CEROS
         BE    PE01A
         CLC   $FEJULIA(2),BLANCOS
         BNE   PE01B
PE01A    MVC   $FEJULIA(2),@CENTURY
PE01     EQU   *
PE01B    MVC   @WJUL,$FEJULIA
         BAL   R9,RTJULOK
         BAL   R9,RTJG        CONVERTIR JULIANA A GREGORIANA
         BAL   R9,RTJB        CONVERTIR JULIANA A FECHA BASE
         BAL   R9,RTLI        OBTENER LITERALES
         SLR   R15,R15
         XC    $CODIGO,$CODIGO
         B     ENDOFPGM       DEVOLVER CONTROL
*        +-----------------------------------------+----------+
*>>>>>>>>|   VERIFICACION/CONVERSION DE GREGORIANA | PE02     |<<<<<<<<
*        +-----------------------------------------+----------+
         CLC   $FEGREGO(2),CEROS
         BE    PE02A
         CLC   $FEGREGO(2),BLANCOS
         BNE   PE02B
PE02A    MVC   $FEGREGO(2),@CENTURY
PE02     EQU   *
PE02B    MVC   @WGRE,$FEGREGO
         BAL   R9,RTGREOK
         BAL   R9,RTGJ        CONVERTIR GREGORIANA A JULIANA
         BAL   R9,RTJB        CONVERTIR JULIANA A FECHA BASE
         BAL   R9,RTLI        OBTENER LITERALES
         SLR   R15,R15
         XC    $CODIGO,$CODIGO
         B     ENDOFPGM       DEVOLVER CONTROL
*        +-----------------------------------------+----------+
*>>>>>>>>|   CONVERSION DE FECHA-BASE              | PE03     |<<<<<<<<
*        +-----------------------------------------+----------+
PE03     EQU   *
         MVC   @WORKD(7),$FEBASE
         TR    @WORKD(7),TBTRNUM
         CLC   @WORKD(7),$FEBASE
         BNE   PE03ERR
         BAL   R9,RTBJ        CONVERTIR BASE A JULIANA
         BAL   R9,RTJG        CONVERTIR JULIANA A GREGORIA
         BAL   R9,RTLI        OBTENER LITERALES
         SLR   R15,R15
         XC    $CODIGO,$CODIGO
         B     ENDOFPGM       DEVOLVER CONTROL
PE03ERR  EQU   *
         MVI   $CODIGO,X'FF'
         MVI   $CODIGO+1,X'FE'          <> FECHA INVALIDA
         MVI   @WORKF,X'FF'
         MVC   @WORKF+1(L'@WORKF-1),@WORKF
         L     R15,@WORKF
         B     ENDOFPGM
*        +-----------------------------------------+----------+
*>>>>>>>>|   FINAL EL PROGRAMA                     | ENDOFPGM |<<<<<<<<
*        +-----------------------------------------+----------+
ENDOFPGM EQU   *
         FIN   CR,TIPO=RENT
*        +-----------------------------------------+----------+
*>>>>>>>>|   CONVERSION JULIANA A GREGORIANA       | RTJG     |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R9                                     |
*        +   RECIBE:   PARAMETROS       $FEGREGO,$FEJULIA     |
*        +   RETORNA:  VALORES EN ESTAS AREAS                 |
*        +----------------------------------------------------+
RTJG     EQU       *
         MVI       $FEGREGO,C'0'
         MVC       $FEGREGO+1(L'$FEGREGO-1),$FEGREGO
*
         MVC       $FEGREGO(4),$FEJULIA     <> TRANSFERIR EL ANO
         PACK      @WORKD(3),$FEJULIA(5)    <> PASAR ANO A BIN
         MVC       @WBAAAA,@WORKD           <> ANO EN BIN
         BAL       R14,RTBI                 <> TTO. DE BISIESTOS
         PACK      @WORKD,$FEJULIA+4(3)     <> EMPAQUETAR EL DIA
         LA        R5,@TBMES                <> TABLA MESES ACTUALIZADA
         L         R1,=F'11'                <> ONCE MESES
         MH        R1,TBMESLGE              <> POR LONG. ELEMENTO
         AR        R5,R1                    <> DIRECC. DICIEMBRE
         ZAP       @WORKF,=P'12'            <> ANOTAR DICIEMBRE
RTJG20   CP        @WORKD,2(2,R5)           <> COMPARAR DIAS TRANSCU
         BH        RTJG30                   <> DETECTADO
         SH        R5,TBMESLGE              <> ELEMENTO ANTERIOR
         SP        @WORKF,=P'1'             <> MES ANTERIOR
         B         RTJG20
RTJG30   UNPK      $FEGREGO+4(2),@WORKF     <> HALLADO MES
         OI        $FEGREGO+5,X'F0'         <> SIGNO
         SP        @WORKD,2(2,R5)           <> RESTA DIAS TRANSCURR.
         UNPK      $FEGREGO+6(2),@WORKD     <> ANOTAR LOS DIAS
         OI        $FEGREGO+7,X'F0'         <> SIGNO
         CP        @WORKD,=P'0'             <> LOS DIAS FUERON 00
         BNE       RTJG99                   <> NO, DEVOLVER CONTROL
         UNPK      $FEGREGO+6(2),0(2,R5)    <> ANOTAR DIAS TOTALES MES
         OI        $FEGREGO+7,X'F0'         <> SIGNO
*
RTJG99   BR        R9                       <> DEVOLVER CONTROL
*        +-----------------------------------------+----------+
*>>>>>>>>|    CONVERSION GREGORIANA A JULIANA      |    RTGJ  |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R9                                     |
*        +   RECIBE:   PARAMETROS       $FEGREGO              |
*        +   RETORNA:  VALORES HALLADOS EN AREAS DE PARAMETR. |
*        +----------------------------------------------------+
RTGJ     EQU       *
         MVI       $FEJULIA,C'0'
         MVC       $FEJULIA+1(L'$FEJULIA-1),$FEJULIA
*
         MVC       $FEJULIA(4),$FEGREGO     <> TRANSFERIR EL ANO
         PACK      @WORKD(3),$FEGREGO(5)    <> PASAR ANO A BIN
         MVC       @WBAAAA,@WORKD           <> ANO EN BIN
         BAL       R14,RTBI                 <> TTO. DE BISIESTOS
         PACK      @WORKD,$FEGREGO+4(2)     <> EMPAQUETAR EL MES
         CVB       R15,@WORKD               <> PASAR A BINARIO
         BCTR      R15,R0                   <> RESTAR UNO
         MH        R15,TBMESLGE             <> CALC. DESPZ. EN TABLA
         LA        R5,@TBMES                <> TABLA DE MESES
         AR        R5,R15                   <> DIRECCIONAR MES
         PACK      @WORKD,$FEGREGO+6(2)     <> EMPAQUETAR EL DIA
         AP        @WORKD,2(2,R5)           <> SUMAR DIAS ANTERIORES
         UNPK      $FEJULIA+4(3),@WORKD+6(2) <> PASAR A PARAMETRO
         OI        $FEJULIA+6,X'F0'         <> SIGNO DE ZONA
RTGJ99   BR        R9                       <> DEVOLVER CONTROL
*        +-----------------------------------------+----------+
*>>>>>>>>|    CONVERSION DE JULIANA A FECHA BASE   | RTJB     |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R9                                     |
*        +   RECIBE:   PARAMETROS       $FEJULIA              |
*        +   RETORNA:  VALORES HALLADOS EN $FEBASE            |
*        +----------------------------------------------------+
*        +   FECHABASE = DIA + ((146097 * (ANO-1)) / 400)     |
*        +----------------------------------------------------+
RTJB     EQU   *
         PACK  @WORKF,$FEJULIA(4)       <> CAPTURAR EL ANO
         SP    @WORKF,=P'1'             <> RESTAR UNO
         ZAP   @WORKD,@WORKF
         MP    @WORKD,=P'365'           <> MULTIPL. POR CONSTANTE
         ZAP   @ACUMUL,@WORKD           <> ACUMULADOR
         ZAP   @WORKD,@WORKF
         DP    @WORKD,=P'4'             <> DIVISION POR 4
         AP    @ACUMUL,@WORKD(7)        <> ACUMULAR PARTE ENTERA
         ZAP   @WORKD,@WORKF
         DP    @WORKD,=P'400'           <> DIVISION POR 400
         AP    @ACUMUL,@WORKD(6)        <> ACUMULAR PARTE ENTERA
         ZAP   @WORKD,@WORKF
         DP    @WORKD,=P'100'           <> DIVISION POR 100
         SP    @ACUMUL,@WORKD(6)        <> RESTAR PARTE ENTERA
         PACK  @WORKF,$FEJULIA+4(3)     <> CAPTURAR LOS DIAS
         AP    @ACUMUL,@WORKF           <> COCIENTE ANTER. + DIAS
         UNPK  $FEBASE,@ACUMUL          <> PASAR A FECHA BASE
         OI    $FEBASE+L'$FEBASE-1,X'F0' > SIGNO
RTJB99   BR        R9                   <> DEVOLVER CONTROL
*        +-----------------------------------------+----------+
*>>>>>>>>|    CONVERSION DE FECHA BASE A JULIANA   | RTBJ     |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R9                                     |
*        +   RECIBE:   PARAMETROS       $FEBASE               |
*        +   RETORNA:  VALORES HALLADOS EN $FEJULIA           |
*        +----------------------------------------------------+
*        +   TECNICA UTILIZADA                                |
*        +   * DIVIDIR FEBASE POR 366 OBTENIENDO UN ANO QUE   |
*        +     SIEMPRE SERA MENOR QUE EL REAL                 |
*        +   * CALCULAR LA FEBASE PARA ESE ANO                |
*        +   * RESTAR DE FEBASE ORIGINAL LA CALCULADA         |
*        +   * SI EL RESTO ES SUPERIOR A 365 (O 366 SI EL A¾O |
*        +     SIGUIENTE FUERA BISIESTO) AUMENTAR UNO AL A¾O  |
*        +     Y RECALCULAR DE NUEVO.                         |
*        +   * CUANDO EL RESTO SEA MENOR A 365 (O 366) EL     |
*        +     A¾O SERA EL SIGUIENTE AL QUE HEMOS UTILIZADO   |
*        +     EN LA ULTIMA BASE Y LOS DIAS EL RESTO.         |
*        +----------------------------------------------------+
RTBJ     EQU       *
         PACK      @WORKD,$FEBASE           <> CAPTURAR FEBASE
         DP        @WORKD,=P'366'           <> OBTENER ANO BASE CALCULO
         ZAP       @WORKANO,@WORKD(6)
*
RTBJ10   EQU       *
         ZAP       @WORKD,@WORKANO
         MP        @WORKD,=P'365'           <> MULTIPL. POR CONSTANTE
         ZAP       @ACUMUL,@WORKD           <> ACUMULADOR
         ZAP       @WORKD,@WORKANO
         DP        @WORKD,=P'4'             <> DIVISION POR 4
         AP        @ACUMUL,@WORKD(7)        <> ACUMULAR PARTE ENTERA
         ZAP       @WORKD,@WORKANO
         DP        @WORKD,=P'400'           <> DIVISION POR 400
         AP        @ACUMUL,@WORKD(6)        <> ACUMULAR PARTE ENTERA
         ZAP       @WORKD,@WORKANO
         DP        @WORKD,=P'100'           <> DIVISION POR 100
         SP        @ACUMUL,@WORKD(6)        <> RESTAR PARTE ENTERA
         PACK      @WORKD,$FEBASE
         SP        @WORKD,@ACUMUL
         ZAP       @WORKF,@WORKANO
         AP        @WORKF,=P'1'
         MVO       @WBAAAA(3),@WORKF+1(3)
         BAL       R14,RTBI                 <> CALCULO DE BISIESTO
         CP        @WORKD,@DIASANO          <> DIAS ANO SIGUIENTE
         BNH       RTBJ20                   <> ANO DETECTADO
         AP        @WORKANO,=P'1'           <> CALCULO A¾O SIGUIENTE
         B         RTBJ10                   <> REPETIMOS BUCLE
*
RTBJ20   EQU       *
         AP        @WORKANO,=P'1'           <> ANO SIGUIENTE
         UNPK      $FEJULIA(4),@WORKANO
         OI        $FEJULIA+3,X'F0'         <> SIGNO
         UNPK      $FEJULIA+4(3),@WORKD     <> DIAS DE DIREFERENCIA
         OI        $FEJULIA+6,X'F0'         <> SIGNO
         CP        @WORKD,=P'0'                DIFERENCIA CERO ?
         BNE       RTBJ99
         UNPK      $FEJULIA+4(3),@DIASANO
         OI        $FEJULIA+6,X'F0'
*
RTBJ99   BR        R9                       <> DEVOLVER CONTROL
*        +-----------------------------------------+----------+
*>>>>>>>>| OBTENCION DE DATOS EN LITERALES         | RTLI     |<<<<<<<<
*        +-----------------------------------------+----------+
*        | ENLACE:     R9                                     |
*        | RECIBE:     DATOS DE FECHAS EN ZONAS PARAMETROS    |
*        | RETORNA:    DATOS EN LITERALES                     |
*        +----------------------------------------------------+
RTLI     EQU       *
         LA        R1,TBIDIOMA
RTLI10   EQU       *
         CLI       0(R1),C'*'          <> FIN DE TABLA, IDIOM DEFECTO
         BE        RTLI12
         CLC       0(4,R1),$IDIOMA
         BE        RTLI12
         LA        R1,8(,R1)           <> SIGUIENTE ENTRADA EN TABLA
         B         RTLI10
RTLI12   EQU       *
         MVC       @ADRIDIO,4(R1)      <> DIRECCION TABLA IDIOMA
*        +------------------------------------------------------------+
*        | CALCULO DEL DIA DE LA SEMANA                               |
*        |                                                            |
*        | DIA-SEMANA NUMERICO = RESTO DE ( FECHABASE / 7 )           |
*        |                                                            |
*        | SIENDO ----> 0=DOMINGO                                     |
*        |              1=LUNES                                       |
*        |              .......                                       |
*        |              6=SABADO                                      |
*        +------------------------------------------------------------+
         PACK      @WORKD,$FEBASE           <> CAPTURAR FECHA BASE
         DP        @WORKD,=P'7'             <> DIVIDIR POR SIETE
         UNPK      $DIASEN,@WORKD+7(1)
         OI        $DIASEN,X'F0'            <> DIA SEMANA NUMERICO
         MVC       @WBSS,$DIASEN            <> PASAR A BINARIO
         MVZ       @WBSS,=X'00'             <> EL DIA SEMANA NUMERICO
         L         R1,@ADRIDIO              <> TABLA DEL IDIOMA
         L         R1,4(,R1)                <> TABLA DE DIAS SEMANA
         SLR       R15,R15
         ICM       R15,B'0001',@WBSS        <> DIA CALCULADO
         MH        R15,0(R1)                <> TAMANO DE CADA ENTRADA
         SLR       R14,R14
         LH        R14,0(R1)                <> GUARDA.TAMA¾O CADA ENTR
         AR        R1,R15
         LA        R1,2(,R1)                <> DIRECCIONA AL DATO
         BCTR      R14,R0                   <> UNO MENOS PARA EXECUTE
         MVC       $DIASEA,BLANCOS
         EX        R14,MVCDIASE             <> MOVER DIA DE LA SEMANA
         B         RTLI20
MVCDIASE MVC       $DIASEA(0),0(R1)         <> MUEVE DIA DE LA SEMAMA
RTLI20   EQU       *
         MVC       $DIANUM,$FEGREGO+6       <> DIA NUMERICO
         L         R1,@ADRIDIO              <> TABLA DEL IDIOMA
         L         R1,0(,R1)                <> TABLA DE DIAS ALFABETICA
         PACK      @WORKD,$DIANUM
         CVB       R15,@WORKD               <> PASAR DIAS A BINARIO
         BCTR      R15,R0                   <> RESTAR UNO
         MH        R15,0(R1)                <> TAMANO DE CADA ENTRADA
         SLR       R14,R14
         LH        R14,0(R1)                <> GUARD TAMANO CADA ENTRA
         AR        R1,R15
         LA        R1,2(,R1)                <> DIRECCIONA AL DATO
         BCTR      R14,R0                   <> UNO MENOS PARA EXECUTE
         MVC       $DIAALF,BLANCOS
         EX        R14,MVCDIAAL             <> MOVER DIA ALFABETICO
         B         RTLI30
MVCDIAAL MVC       $DIAALF(0),0(R1)         <> MUEVE DIA ALFABETICO
RTLI30   EQU       *
         MVC       $MESNUM,$FEGREGO+4       <> MES NUMERICO
         L         R1,@ADRIDIO              <> TABLA DEL IDIOMA
         L         R1,12(,R1)               <> TABLA DE MES LARGO
         PACK      @WORKD,$MESNUM
         CVB       R15,@WORKD               <> PASAR DIAS A BINARIO
         BCTR      R15,R0                   <> RESTAR UNO
         MH        R15,0(R1)                <> TAMANO DE CADA ENTRADA
         SLR       R14,R14
         LH        R14,0(R1)                <> GUARD TAMANO CADA ENTRA
         AR        R1,R15
         LA        R1,2(,R1)                <> DIRECCIONA AL DATO
         BCTR      R14,R0                   <> UNO MENOS PARA EXECUTE
         MVC       $MESALF,BLANCOS
         EX        R14,MVCMESAL             <> MOVER MES ALFABETICO
         B         RTLI40
MVCMESAL MVC       $MESALF(0),0(R1)         <> MUEVE MES ALFABETICO
RTLI40   EQU       *
         MVC       $ANONUM,$FEGREGO         <> ANO NUMERICO
         MVC       $ANOALF,BLANCOS          <> ANO ALFABETICO
         L         R1,@ADRIDIO              <> TABLA DEL IDIOMA
         L         R1,8(,R1)                <> TABLA DE MES CORTO
         PACK      @WORKD,$FEGREGO+4(2)
         CVB       R15,@WORKD               <> PASAR DIAS A BINARIO
         BCTR      R15,R0                   <> RESTAR UNO
         MH        R15,0(R1)                <> TAMANO DE CADA ENTRADA
         AR        R1,R15
         LA        R1,2(,R1)                <> DIRECCIONA AL DATO
*
         MVC       $FEEDT1(2),$FEGREGO+6
         MVI       $FEEDT1+2,C'.'
         MVC       $FEEDT1+3(3),0(R1)
         MVI       $FEEDT1+6,C'.'
         MVC       $FEEDT1+7(4),$FEGREGO
*
         MVC       $FEEDT2(7),$FEEDT1
         MVC       $FEEDT2+7(2),$FEEDT1+9
*
         MVC       $FEEDT3(2),$FEGREGO+6
         MVI       $FEEDT3+2,C'.'
         MVC       $FEEDT3+3(2),$FEGREGO+4
         MVI       $FEEDT3+5,C'.'
         MVC       $FEEDT3+6(4),$FEGREGO
*
         MVC       $FEEDT4(6),$FEEDT3
         MVC       $FEEDT4+6(2),$FEEDT3+8
*
         MVC       $HORA,@HIPL
         MVC       $MINUTO,@HIPL+2
         MVC       $SEGUNDO,@HIPL+4
         MVC       $DECIMAS,@HIPL+6
         MVI       $HOREDT,C':'
         MVC       $HOREDT+1(L'$HOREDT-1),$HOREDT
         MVC       $HOREDT(2),$HORA
         MVC       $HOREDT+3(2),$MINUTO
         MVC       $HOREDT+6(2),$SEGUNDO
         MVC       $HOREDT+9(2),$DECIMAS
*
         MVC       $HORBIN,@TIMEDAT
         MVI       $HORALF,C' '
         MVC       $HORALF+1(L'$HORALF-1),$HORALF
*
         BR        R9                  <> DEVOLUCION DE CONTROL
*        +-----------------------------------------+----------+
*>>>>>>>>| VERIFICACION DE FECHA GREGORIANA        | RTGREOK  |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R9                                     |
*        +   RECIBE:   AREA @WGRE                             |
*        +   RETORNA:  SI CORRECTA: POR R9                    |
*        +             SI INCORRECTA: -2 Y FIN DE EJECUCION   |
*        +----------------------------------------------------+
RTGREOK  EQU       *
         MVC       @WORKD,@WGRE
         TR        @WORKD,TBTRNUM
         CLC       @WORKD,@WGRE
         BNE       RTGREERR
         CLC       @WGRE+4(2),=C'01'
         BL        RTGREERR
         CLC       @WGRE+4(2),=C'12'
         BH        RTGREERR
         PACK      @WORKD(3),@WGRE(5)
         MVC       @WBAAAA,@WORKD
         BAL       R14,RTBI                 <> CALCULAR BISIESTO
         PACK      @WORKD,@WGRE+4(2)        <> PACK EL MES
         CVB       R1,@WORKD
         BCTR      R1,R0                    <> MES MENOS UNO
         MH        R1,TBMESLGE
         LA        R15,@TBMES
         AR        R15,R1                   <> DIAS DEL MES
         PACK      @WORKF,@WGRE+6(2)
         CP        @WORKF,=P'1'
         BL        RTGREERR
         CP        @WORKF,0(2,R15)          <> DIAS MAXIMOS DEL MES
         BH        RTGREERR
         BR        R9                       <> DEVOLVER CONTROL
RTGREERR EQU       *
         MVI       $CODIGO,X'FF'            <> RETORNO  -2
         MVI       $CODIGO+1,X'FE'          <> FECHA INVALIDA
         MVI       @WORKF,X'FF'
         MVC       @WORKF+1(L'@WORKF-1),@WORKF
         MVI       @WORKF+3,X'FE'
         L         R15,@WORKF
         B         ENDOFPGM                 <> FIN DE EJECUCION
*        +-----------------------------------------+----------+
*>>>>>>>>| VERIFICACION DE FECHA JULIANA           | RTJULOK  |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R9                                     |
*        +   RECIBE:   AREA @WJUL                             |
*        +   RETORNA:  SI CORRECTA: POR R9                    |
*        +             SI INCORRECTA: CR. -2 Y FIN MODULO     |
*        +----------------------------------------------------+
RTJULOK  EQU       *
         MVC       @WORKD(7),@WJUL
         TR        @WORKD(7),TBTRNUM
         CLC       @WORKD(7),@WJUL
         BNE       RTJULERR
         PACK      @WORKD(3),@WJUL(5)
         MVC       @WBAAAA,@WORKD
         BAL       R14,RTBI                 <> CALCULAR BISIESTO
         PACK      @WORKF,@WJUL+4(3)        <> OBTENER DIAS
         CP        @WORKF,=P'1'
         BL        RTJULERR
         CP        @WORKF,@DIASANO          <> COMPARAR DIAS MAXIMOS
         BH        RTJULERR
         BR        R9                       <> DEVOLVER CONTROL
RTJULERR EQU       *
         MVI       $CODIGO,X'FF'
         MVI       $CODIGO+1,X'FE'          <> FECHA INVALIDA
         MVI       @WORKF,X'FF'
         MVC       @WORKF+1(L'@WORKF-1),@WORKF
         MVI       @WORKF+3,X'FE'
         L         R15,@WORKF
         B         ENDOFPGM
*        +-----------------------------------------+----------+
*>>>>>>>>| DETECCION DE ANO BISIESTO               | RTBI     |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R14                                    |
*        +   RECIBE:   AREA @WBAAAA RELLENA                   |
*        +   RETORNA:  VALORES ACTUALIZADOS DEL ANO EN @TBMES |
*        +----------------------------------------------------+
RTBI     EQU       *
         ZAP       @DIASANO,=P'365'         <> POR DEFECTO 365 DIAS
         MVC       @TBMES(TBMESESL),TBMESES <> COPIA TABLA VALOR MESES
         TM        @WBAAAA+1,X'01'          <> ES ANO IMPAR
         BO        RTBI99                   <> SI, NO ES BISIESTO
         TM        @WBAAAA+1,X'12'          <> ES DIVISIBLE POR CUATRO
         BM        RTBI99                   <> NO, NO ES BISIESTO
         CLI       @WBAAAA+1,X'00'          <> ACABADO EN '00'
         BNE       RTBI10                   <> NO, ANO BISIESTO
         TM        @WBAAAA,X'01'            <> CENTENA IMPAR ?
         BO        RTBI99                   <> SI, NO ES BISIESTO
         TM        @WBAAAA,X'12'            <> DIVISIBLE POR CUATROCI.
         BM        RTBI99                   <> NO, DEVOLVER CONTROL
*
RTBI10   EQU       *
         ZAP       @DIASANO,=P'366'         <> ES BISIESTO, 366 DIAS
         LA        R15,@TBMES               <> DIRECCIONAR
         AH        R15,TBMESLGE             <> AL MES DE FEBRERO
         MVC       0(2,R15),=PL2'29'        <> ACTUALIZAR FEBRERO
         AH        R15,TBMESLGE             <> DIRECC. DIAS MARZO
         SLR       R1,R1
         LA        R1,10                    <> 10 MESES A TRATAR
RTBI20   EQU       *
         AP        2(2,R15),=P'1'           <> SUMAR UNO
         AH        R15,TBMESLGE             <> AVANZAR LA TABLA
         BCT       R1,RTBI20                <> REPETIR BUCLE
*
RTBI99   BR        R14                      <> DEVOLVER CONTROL
*        +--------------------------------+
*>>>>>>>>| RESERVA DE AREAS ESTATICAS     |
*        +--------------------------------+
         DS    0F
KBSM     DC    X'80000000'
*
BLANCOS  DC    CL40' '
CEROS    DC    CL8'00000000'
*
TIME     TIME  LINKAGE=SYSTEM,MF=L
TIMEL    EQU   *-TIME
*
TBTRNUM  DC    X'00000000000000000000000000000000' 0
         DC    X'00000000000000000000000000000000' 1
         DC    X'00000000000000000000000000000000' 2
         DC    X'00000000000000000000000000000000' 3
         DC    X'00000000000000000000000000000000' 4
         DC    X'00000000000000000000000000000000' 5
         DC    X'00000000000000000000000000000000' 6
         DC    X'00000000000000000000000000000000' 7
         DC    X'00000000000000000000000000000000' 8
         DC    X'00000000000000000000000000000000' 9
         DC    X'00000000000000000000000000000000' A
         DC    X'00000000000000000000000000000000' B
         DC    X'00000000000000000000000000000000' C
         DC    X'00000000000000000000000000000000' D
         DC    X'00000000000000000000000000000000' E
         DC    X'F0F1F2F3F4F5F6F7F8F9000000000000' F
*
TBPETICL DC    F'8'                 <> LONGITUD DE CADA ELEMENTO
TBPETIC  DC    H'0',CL2'  ',A(PE00) OBTIENE FECHA DEL DIA
         DC    H'1',CL2'  ',A(PE01) CONVERSION JULIANA
         DC    H'2',CL2'  ',A(PE02) CONVERSION GREGORIANA
         DC    H'3',CL2'  ',A(PE03) CONVERSION FECHA-BASE
         DC    C'****',A(PERR)      ERROR FIN DE TABLA
*
         DS    0F
TBMESLGE DC    H'4'                    <> LONG. CADA ELEMENTO TABLA
TBMESES  EQU   *
         DC    PL2'31',PL2'000'
         DC    PL2'28',PL2'031'
         DC    PL2'31',PL2'059'
         DC    PL2'30',PL2'090'
         DC    PL2'31',PL2'120'
         DC    PL2'30',PL2'151'
         DC    PL2'31',PL2'181'
         DC    PL2'31',PL2'212'
         DC    PL2'30',PL2'243'
         DC    PL2'31',PL2'273'
         DC    PL2'30',PL2'304'
         DC    PL2'31',PL2'334'
TBMESESL EQU   *-TBMESES
*
TBIDIOMA DS    0F
         DC    CL4'341 ',A(TBI341)     <> CASTELLANO
         DC    CL4'343 ',A(TBI343)  ------CATALAN------- FALTA
         DC    CL4'344 ',A(TBI346)  ------VASCO--------- FALTA
         DC    CL4'3481',A(TBI3481) ------GALLEGO------- FALTA
         DC    CL4'33  ',A(TBI33)      <> FRANCES
         DC    CL4'351 ',A(TBI351)  ------PORTUGUES----- FALTA
         DC    CL4'39  ',A(TBI39)      <> ITALIANO
         DC    CL4'44  ',A(TBI44)      <> INGLES
         DC    CL4'49  ',A(TBI49)      <> ALEMAN
         DC    CL4'****',A(TBI341)     <> CASTELLANO ES EL DEFECTO
*
*  TBI341 -->  CASTELLANO
*
TBI341   DS    0F
         DC    A(TBI341D)
         DC    A(TBI341S)
         DC    A(TBI341C)
         DC    A(TBI341M)
TBI341D  DC    H'13'
         DC    CL13'UNO'
         DC    CL13'DOS'
         DC    CL13'TRES'
         DC    CL13'CUATRO'
         DC    CL13'CINCO'
         DC    CL13'SEIS'
         DC    CL13'SIETE'
         DC    CL13'OCHO'
         DC    CL13'NUEVE'
         DC    CL13'DIEZ'
         DC    CL13'ONCE'
         DC    CL13'DOCE'
         DC    CL13'TRECE'
         DC    CL13'CATORCE'
         DC    CL13'QUINCE'
         DC    CL13'DIECISEIS'
         DC    CL13'DIECISIETE'
         DC    CL13'DIECIOCHO'
         DC    CL13'DIECINUEVE'
         DC    CL13'VEINTE'
         DC    CL13'VEINTIUNO'
         DC    CL13'VEINTIDOS'
         DC    CL13'VEINTITRES'
         DC    CL13'VEINTICUATRO'
         DC    CL13'VEINTICINCO'
         DC    CL13'VEINTISEIS'
         DC    CL13'VEINTISIETE'
         DC    CL13'VEINTIOCHO'
         DC    CL13'VEINTINUEVE'
         DC    CL13'TREINTA'
         DC    CL13'TREINTA Y UNO'
TBI341S  DC    H'09'
         DC    CL09'DOMINGO'
         DC    CL09'LUNES'
         DC    CL09'MARTES'
         DC    CL09'MIERCOLES'
         DC    CL09'JUEVES'
         DC    CL09'VIERNES'
         DC    CL09'SABADO'
TBI341C  DC    H'03'
         DC    CL03'ENE'
         DC    CL03'FEB'
         DC    CL03'MAR'
         DC    CL03'ABR'
         DC    CL03'MAY'
         DC    CL03'JUN'
         DC    CL03'JUL'
         DC    CL03'AGO'
         DC    CL03'SEP'
         DC    CL03'OCT'
         DC    CL03'NOV'
         DC    CL03'DIC'
TBI341M  DC    H'10'
         DC    CL10'ENERO'
         DC    CL10'FEBRERO'
         DC    CL10'MARZO'
         DC    CL10'ABRIL'
         DC    CL10'MAYO'
         DC    CL10'JUNIO'
         DC    CL10'JULIO'
         DC    CL10'AGOSTO'
         DC    CL10'SEPTIEMBRE'
         DC    CL10'OCTUBRE'
         DC    CL10'NOVIEMBRE'
         DC    CL10'DICIEMBRE'
*
*  TBI343 -->  CATALAN
*
TBI343   DS    0F
         DC    A(TBI343D)
         DC    A(TBI343S)
         DC    A(TBI343C)
         DC    A(TBI343M)
TBI343D  DC    H'13'
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
TBI343S  DC    H'09'                >> CATALAN <<
         DC    CL09'.......'        >> CATALAN <<
         DC    CL09'.......'        >> CATALAN <<
         DC    CL09'.......'        >> CATALAN <<
         DC    CL09'.......'        >> CATALAN <<
         DC    CL09'.......'        >> CATALAN <<
         DC    CL09'.......'        >> CATALAN <<
         DC    CL09'.......'        >> CATALAN <<
TBI343C  DC    H'03'                >> CATALAN <<
         DC    CL03'...'            >> CATALAN <<
         DC    CL03'...'            >> CATALAN <<
         DC    CL03'...'            >> CATALAN <<
         DC    CL03'...'            >> CATALAN <<
         DC    CL03'...'            >> CATALAN <<
         DC    CL03'...'            >> CATALAN <<
         DC    CL03'...'            >> CATALAN <<
         DC    CL03'...'            >> CATALAN <<
         DC    CL03'...'            >> CATALAN <<
         DC    CL03'...'            >> CATALAN <<
         DC    CL03'...'            >> CATALAN <<
         DC    CL03'...'            >> CATALAN <<
TBI343M  DC    H'10'                >> CATALAN <<
         DC    CL10'.....'          >> CATALAN <<
         DC    CL10'.....'          >> CATALAN <<
         DC    CL10'.....'          >> CATALAN <<
         DC    CL10'.....'          >> CATALAN <<
         DC    CL10'.....'          >> CATALAN <<
         DC    CL10'.....'          >> CATALAN <<
         DC    CL10'.....'          >> CATALAN <<
         DC    CL10'.....'          >> CATALAN <<
         DC    CL10'.....'          >> CATALAN <<
         DC    CL10'.....'          >> CATALAN <<
         DC    CL10'.....'          >> CATALAN <<
         DC    CL10'.....'          >> CATALAN <<
*
*  TBI346 -->  VASCO
*
TBI346   DS    0F
         DC    A(TBI346D)
         DC    A(TBI346S)
         DC    A(TBI346C)
         DC    A(TBI346M)
TBI346D  DC    H'13'
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
         DC    CL13'...'            >> VASCO <<
TBI346S  DC    H'09'                >> VASCO <<
         DC    CL09'.......'        >> VASCO <<
         DC    CL09'.......'        >> VASCO <<
         DC    CL09'.......'        >> VASCO <<
         DC    CL09'.......'        >> VASCO <<
         DC    CL09'.......'        >> VASCO <<
         DC    CL09'.......'        >> VASCO <<
         DC    CL09'.......'        >> VASCO <<
TBI346C  DC    H'03'                >> VASCO <<
         DC    CL03'...'            >> VASCO <<
         DC    CL03'...'            >> VASCO <<
         DC    CL03'...'            >> VASCO <<
         DC    CL03'...'            >> VASCO <<
         DC    CL03'...'            >> VASCO <<
         DC    CL03'...'            >> VASCO <<
         DC    CL03'...'            >> VASCO <<
         DC    CL03'...'            >> VASCO <<
         DC    CL03'...'            >> VASCO <<
         DC    CL03'...'            >> VASCO <<
         DC    CL03'...'            >> VASCO <<
         DC    CL03'...'            >> VASCO <<
TBI346M  DC    H'10'                >> VASCO <<
         DC    CL10'.....'          >> VASCO <<
         DC    CL10'.....'          >> VASCO <<
         DC    CL10'.....'          >> VASCO <<
         DC    CL10'.....'          >> VASCO <<
         DC    CL10'.....'          >> VASCO <<
         DC    CL10'.....'          >> VASCO <<
         DC    CL10'.....'          >> VASCO <<
         DC    CL10'.....'          >> VASCO <<
         DC    CL10'.....'          >> VASCO <<
         DC    CL10'.....'          >> VASCO <<
         DC    CL10'.....'          >> VASCO <<
         DC    CL10'.....'          >> VASCO <<
*
*  TBI3481 --> GALLEGO
*
TBI3481  DS    0F
         DC    A(TBI3481D)
         DC    A(TBI3481S)
         DC    A(TBI3481C)
         DC    A(TBI3481M)
TBI3481D DC    H'13'
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
         DC    CL13'....'           >> GALLEGO <<
TBI3481S DC    H'09'                >> GALLEGO <<
         DC    CL09'.........'      >> GALLEGO <<
         DC    CL09'.........'      >> GALLEGO <<
         DC    CL09'.........'      >> GALLEGO <<
         DC    CL09'.........'      >> GALLEGO <<
         DC    CL09'.........'      >> GALLEGO <<
         DC    CL09'.........'      >> GALLEGO <<
         DC    CL09'.........'      >> GALLEGO <<
TBI3481C DC    H'09'                >> GALLEGO <<
         DC    CL03'...'            >> GALLEGO <<
         DC    CL03'...'            >> GALLEGO <<
         DC    CL03'...'            >> GALLEGO <<
         DC    CL03'...'            >> GALLEGO <<
         DC    CL03'...'            >> GALLEGO <<
         DC    CL03'...'            >> GALLEGO <<
         DC    CL03'...'            >> GALLEGO <<
         DC    CL03'...'            >> GALLEGO <<
         DC    CL03'...'            >> GALLEGO <<
         DC    CL03'...'            >> GALLEGO <<
         DC    CL03'...'            >> GALLEGO <<
         DC    CL03'...'            >> GALLEGO <<
TBI3481M DC    H'10'                >> GALLEGO <<
         DC    CL10'.....'          >> GALLEGO <<
         DC    CL10'.....'          >> GALLEGO <<
         DC    CL10'.....'          >> GALLEGO <<
         DC    CL10'.....'          >> GALLEGO <<
         DC    CL10'.....'          >> GALLEGO <<
         DC    CL10'.....'          >> GALLEGO <<
         DC    CL10'.....'          >> GALLEGO <<
         DC    CL10'.....'          >> GALLEGO <<
         DC    CL10'.....'          >> GALLEGO <<
         DC    CL10'.....'          >> GALLEGO <<
         DC    CL10'.....'          >> GALLEGO <<
         DC    CL10'.....'          >> GALLEGO <<
*
*  TBI44  ---> INGLES
*
TBI44    DS    0F                      <> INGLES
         DC    A(TBI44D)
         DC    A(TBI44S)
         DC    A(TBI44C)
         DC    A(TBI44M)
TBI44D   DC    H'12'
         DC    CL12'ONE'
         DC    CL12'TWO'
         DC    CL12'THREE'
         DC    CL12'FOUR'
         DC    CL12'FIVE'
         DC    CL12'SIX'
         DC    CL12'SEVEN'
         DC    CL12'EIGHT'
         DC    CL12'NINE'
         DC    CL12'TEN'
         DC    CL12'ELEVEN'
         DC    CL12'TWELVE'
         DC    CL12'THIRTEEN'
         DC    CL12'FORTEEN'
         DC    CL12'FIFTEEN'
         DC    CL12'SIXTEEN'
         DC    CL12'SEVENTEEN'
         DC    CL12'EIGHTEEN'
         DC    CL12'NINETEEN'
         DC    CL12'TWENTY'
         DC    CL12'TWENTY ONE'
         DC    CL12'TWENTY TWO'
         DC    CL12'TWENTY THREE'
         DC    CL12'TWENTY FOUR'
         DC    CL12'TWENTY FIVE'
         DC    CL12'TWENTY SIX'
         DC    CL12'TWENTY SEVEN'
         DC    CL12'TWENTY EIGHT'
         DC    CL12'TWENTY NINE'
         DC    CL12'THIRTY'
         DC    CL12'THIRTY ONE'
TBI44S   DC    H'09'
         DC    CL09'SUNDAY'
         DC    CL09'MONDAY'
         DC    CL09'TUESDAY'
         DC    CL09'WEDNESDAY'
         DC    CL09'THURSDAY'
         DC    CL09'FRIDAY'
         DC    CL09'SATURDAY'
TBI44C   DC    H'03'
         DC    CL03'JAN'
         DC    CL03'FEB'
         DC    CL03'MAR'
         DC    CL03'APR'
         DC    CL03'MAY'
         DC    CL03'JUN'
         DC    CL03'JUL'
         DC    CL03'AUG'
         DC    CL03'SEP'
         DC    CL03'OCT'
         DC    CL03'NOV'
         DC    CL03'DEC'
TBI44M   DC    H'09'
         DC    CL09'JANUARY'
         DC    CL09'FEBRUARY'
         DC    CL09'MARCH'
         DC    CL09'APRIL'
         DC    CL09'MAY'
         DC    CL09'JUNE'
         DC    CL09'JULY'
         DC    CL09'AUGUST'
         DC    CL09'SEPTEMBER'
         DC    CL09'OCTOBER'
         DC    CL09'NOVEMBER'
         DC    CL09'DECEMBER'
*
*  TBI33  ---> FRANCES
*
TBI33    DS    0F                      <> FRANCES
         DC    A(TBI33D)
         DC    A(TBI33S)
         DC    A(TBI33C)
         DC    A(TBI33M)
TBI33D   DC    H'12'
         DC    CL12'UN'
         DC    CL12'DEUX'
         DC    CL12'TROIS'
         DC    CL12'QUATRE'
         DC    CL12'CINQ'
         DC    CL12'SIX'
         DC    CL12'SEPT'
         DC    CL12'HUIT'
         DC    CL12'NEUF'
         DC    CL12'DIX'
         DC    CL12'ONZE'
         DC    CL12'DOUZE'
         DC    CL12'TREIZE'
         DC    CL12'QUATORZE'
         DC    CL12'QUINZE'
         DC    CL12'SEIZE'
         DC    CL12'DIX-SEPT'
         DC    CL12'DIX-HUIT'
         DC    CL12'DIX-NEUF'
         DC    CL12'VINGT'
         DC    CL12'VINGT UN'
         DC    CL12'VINGT DEUX'
         DC    CL12'VINGT TROIS'
         DC    CL12'VINGT QUATRE'
         DC    CL12'VINGT CINQ'
         DC    CL12'VINGT SIX'
         DC    CL12'VINGT SEPT'
         DC    CL12'VINGT HUIT'
         DC    CL12'VINGT NEUF'
         DC    CL12'TRENTE'
         DC    CL12'TRENTE UNE INT'
TBI33S   DC    H'08'
         DC    CL08'DIMANCHE'
         DC    CL08'LUNDI'
         DC    CL08'MARDI'
         DC    CL08'MERCREDI'
         DC    CL08'JEUDI'
         DC    CL08'VENDREDI'
         DC    CL08'SAMEDI'
TBI33C   DC    H'03'
         DC    CL03'JAN'
         DC    CL03'FEB'
         DC    CL03'MAR'
         DC    CL03'AVR'
         DC    CL03'MAI'
         DC    CL03'JUI'
         DC    CL03'JUL'
         DC    CL03'AOU'
         DC    CL03'SEP'
         DC    CL03'OCT'
         DC    CL03'NOV'
         DC    CL03'DEC'
TBI33M   DC    H'09'
         DC    CL09'JANVIER'
         DC    CL09'FEVRIER'
         DC    CL09'MARS'
         DC    CL09'AVRIL'
         DC    CL09'MAI'
         DC    CL09'JUIN'
         DC    CL09'JUILLET'
         DC    CL09'AOUT'
         DC    CL09'SEPTEMBRE'
         DC    CL09'OCTOBRE'
         DC    CL09'NOVEMBRE'
         DC    CL09'DECEMBRE'
*
*  TBI39  ---> ITALIANO
*
TBI39    DS    0F
         DC    A(TBI39D)
         DC    A(TBI39S)
         DC    A(TBI39C)
         DC    A(TBI39M)
TBI39D   DC    H'12'
         DC    CL12'UN'            << ITALIANO >>
         DC    CL12'DUE'           << ITALIANO >>
         DC    CL12'TRE'           << ITALIANO >>
         DC    CL12'QUATTRO'       << ITALIANO >>
         DC    CL12'CINQUE'        << ITALIANO >>
         DC    CL12'SEI'           << ITALIANO >>
         DC    CL12'SETTE'         << ITALIANO >>
         DC    CL12'OTTO'          << ITALIANO >>
         DC    CL12'NOVE'          << ITALIANO >>
         DC    CL12'DIECI'         << ITALIANO >>
         DC    CL12'UNDICI'        << ITALIANO >>
         DC    CL12'DODICI'        << ITALIANO >>
         DC    CL12'TREDICI'       << ITALIANO >>
         DC    CL12'QUATTORDICI'   << ITALIANO >>
         DC    CL12'QUINDICI'      << ITALIANO >>
         DC    CL12'SEDICI'        << ITALIANO >>
         DC    CL12'DICIASSETTE'   << ITALIANO >>
         DC    CL12'DICIOTTO'      << ITALIANO >>
         DC    CL12'DICIANNOVE'    << ITALIANO >>
         DC    CL12'VENTI'         << ITALIANO >>
         DC    CL12'VENTUNO'       << ITALIANO >>
         DC    CL12'VEINTIDUE'     << ITALIANO >>
         DC    CL12'VENTITRE'      << ITALIANO >>
         DC    CL12'VENTIQUATTRO'  << ITALIANO >>
         DC    CL12'VENTICINQUE'   << ITALIANO >>
         DC    CL12'VENTISEI'      << ITALIANO >>
         DC    CL12'VENTISETTE'    << ITALIANO >>
         DC    CL12'VENTOTTO'      << ITALIANO >>
         DC    CL12'VENTINOVE'     << ITALIANO >>
         DC    CL12'TRENTA'        << ITALIANO >>
         DC    CL12'TRENTAUNO'     << ITALIANO >>
TBI39S   DC    H'10'               << ITALIANO >>
         DC    CL10'DOMENICA'      << ITALIANO >>
         DC    CL10'LUNEDI'        << ITALIANO >>
         DC    CL10'MARTEDI'       << ITALIANO >>
         DC    CL10'MIERCOLEDI'    << ITALIANO >>
         DC    CL10'GIOVEDI'       << ITALIANO >>
         DC    CL10'VENERDI'       << ITALIANO >>
         DC    CL10'SABATO'        << ITALIANO >>
TBI39C   DC    H'03'               << ITALIANO >>
         DC    CL03'GEN'           << ITALIANO >>
         DC    CL03'FEB'           << ITALIANO >>
         DC    CL03'MAR'           << ITALIANO >>
         DC    CL03'APR'           << ITALIANO >>
         DC    CL03'MAG'           << ITALIANO >>
         DC    CL03'GIU'           << ITALIANO >>
         DC    CL03'LUG'           << ITALIANO >>
         DC    CL03'AUG'           << ITALIANO >>
         DC    CL03'SET'           << ITALIANO >>
         DC    CL03'OTT'           << ITALIANO >>
         DC    CL03'NOV'           << ITALIANO >>
         DC    CL03'DIC'           << ITALIANO >>
TBI39M   DC    H'09'               << ITALIANO >>
         DC    CL09'GENNAIO'       << ITALIANO >>
         DC    CL09'FEBBRAIO'      << ITALIANO >>
         DC    CL09'MARZO'         << ITALIANO >>
         DC    CL09'APRILE'        << ITALIANO >>
         DC    CL09'MAGGIO'        << ITALIANO >>
         DC    CL09'GIUGNO'        << ITALIANO >>
         DC    CL09'LUGLIO'        << ITALIANO >>
         DC    CL09'AUGUST'        << ITALIANO >>
         DC    CL09'SETTEMBRE'     << ITALIANO >>
         DC    CL09'OTTOBRE'       << ITALIANO >>
         DC    CL09'NOVEMBRE'      << ITALIANO >>
         DC    CL09'DICEMBRE'      << ITALIANO >>
*
*  TBI49  ---> ALEMAN
*
TBI49    DS    0F
         DC    A(TBI49D)
         DC    A(TBI49S)
         DC    A(TBI49C)
         DC    A(TBI49M)
TBI49D   DC    H'16'
         DC    CL16'EINS'              << ALEMAN >>
         DC    CL16'ZWEI'              << ALEMAN >>
         DC    CL16'DREI'              << ALEMAN >>
         DC    CL16'VIER'              << ALEMAN >>
         DC    CL16'FUNF'              << ALEMAN >>
         DC    CL16'SECHS'             << ALEMAN >>
         DC    CL16'SIEBEN'            << ALEMAN >>
         DC    CL16'ACHT'              << ALEMAN >>
         DC    CL16'NEUN'              << ALEMAN >>
         DC    CL16'ZEHN'              << ALEMAN >>
         DC    CL16'ELF'               << ALEMAN >>
         DC    CL16'ZWOLF'             << ALEMAN >>
         DC    CL16'DREIZEHN'          << ALEMAN >>
         DC    CL16'VIERZEHN'          << ALEMAN >>
         DC    CL16'FUNFZEHN'          << ALEMAN >>
         DC    CL16'SECHZEHN'          << ALEMAN >>
         DC    CL16'SIEBZEHN'          << ALEMAN >>
         DC    CL16'ACHTZEHN'          << ALEMAN >>
         DC    CL16'NEUNZEHN'          << ALEMAN >>
         DC    CL16'ZWANZIG'           << ALEMAN >>
         DC    CL16'EINUNDZWANZIG'     << ALEMAN >>
         DC    CL16'ZWEIUNDZWANZIG'    << ALEMAN >>
         DC    CL16'DEIUNDZWANZIG'     << ALEMAN >>
         DC    CL16'VIERUNDZWANZIG'    << ALEMAN >>
         DC    CL16'FUNFUNDZWANZIG'    << ALEMAN >>
         DC    CL16'SECHSUNDZWANZIG'   << ALEMAN >>
         DC    CL16'SIEBENUNDZWANZIG'  << ALEMAN >>
         DC    CL16'ACHTUNDZWANZIG'    << ALEMAN >>
         DC    CL16'NEUNUNDZWANZIG'    << ALEMAN >>
         DC    CL16'DREISSIG'          << ALEMAN >>
         DC    CL16'EINUNDREISSIG'     << ALEMAN >>
TBI49S   DC    H'10'                   << ALEMAN >>
         DC    CL10'SONNTAG'           << ALEMAN >>
         DC    CL10'MONTAG'            << ALEMAN >>
         DC    CL10'DIENSTAG'          << ALEMAN >>
         DC    CL10'MITTWOCH'          << ALEMAN >>
         DC    CL10'DONNERSTAG'        << ALEMAN >>
         DC    CL10'FREITAG'           << ALEMAN >>
         DC    CL10'SAMSTAG'           << ALEMAN >>
TBI49C   DC    H'03'                   << ALEMAN >>
         DC    CL03'JAN'               << ALEMAN >>
         DC    CL03'FEB'               << ALEMAN >>
         DC    CL03'MAR'               << ALEMAN >>
         DC    CL03'APR'               << ALEMAN >>
         DC    CL03'MAI'               << ALEMAN >>
         DC    CL03'JUN'               << ALEMAN >>
         DC    CL03'JUL'               << ALEMAN >>
         DC    CL03'AUG'               << ALEMAN >>
         DC    CL03'SEP'               << ALEMAN >>
         DC    CL03'OKT'               << ALEMAN >>
         DC    CL03'NOV'               << ALEMAN >>
         DC    CL03'DEZ'               << ALEMAN >>
TBI49M   DC    H'09'                   << ALEMAN >>
         DC    CL09'JANUAR'            << ALEMAN >>
         DC    CL09'FEBRUAR'           << ALEMAN >>
         DC    CL09'MARZ'              << ALEMAN >>
         DC    CL09'APRIL'             << ALEMAN >>
         DC    CL09'MAI'               << ALEMAN >>
         DC    CL09'JUNI'              << ALEMAN >>
         DC    CL09'JULI'              << ALEMAN >>
         DC    CL09'AUGUST'            << ALEMAN >>
         DC    CL09'SEPTEMBER'         << ALEMAN >>
         DC    CL09'OKTOBER'           << ALEMAN >>
         DC    CL09'NOVEMBER'          << ALEMAN >>
         DC    CL09'DEZEMBER'          << ALEMAN >>
*
*
*  TB351  ---> PORTUGUES
*
TBI351   DS    0F
         DC    A(TBI351D)
         DC    A(TBI351S)
         DC    A(TBI351C)
         DC    A(TBI351M)
TBI351D  DC    H'12'
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
TBI351S  DC    H'10'             << PORTUGUES >>
         DC    CL10'..NNTAG'     << PORTUGUES >>
         DC    CL10'..NTAG'      << PORTUGUES >>
         DC    CL10'..ENSTAG'    << PORTUGUES >>
         DC    CL10'..TTWOCH'    << PORTUGUES >>
         DC    CL10'..NNERSTAG'  << PORTUGUES >>
         DC    CL10'..EITAG'     << PORTUGUES >>
         DC    CL10'..MSTAG'     << PORTUGUES >>
TBI351C  DC    H'03'             << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
TBI351M  DC    H'09'             << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
*
         LTORG
*
* ---------------------------------------------------------------------
*        RESERVA DE AREAS DINAMICAS
* ---------------------------------------------------------------------
@DATA    DSECT
         DS    18F
*
@TBMES   ORG   *+TBMESESL
*
@TIME    ORG   *+TIMEL
*
@TIMEDAT DS    CL16
@FIPL    DS    CL9
@HIPL    DS    CL9
@CENTURY DS    CL2
@DIASANO DS    PL2                          <> VARIABLE DEVUELTA POR LA
*                                              RUTINA DE ANO BISIESTO
*                                              RTBI CON 365 O 366
@WBAAAA  DS    CL2
@WBMM    DS    CL1
@WBDD    DS    CL1
@WBSS    DS    CL1
@ACUMUL  DS    D
@WORKD   DS    D
@WORKF   DS    F
@WORKH   DS    H
@WORKANO DS    PL3
*
@ADRIDIO DS    F                            <> ADDR.CALCULADA IDIOMA
*
@ANOINI  DS    PL4
@DIAINI  DS    PL4
@FECINI  DS    PL4
@FECFIN  DS    PL4
@DIFERE  DS    PL4
*
@WGRE    DS    CL8     GREGORIANA PARA VERIFICACION
@WJUL    DS    CL7     JULIANA PARA VERIFICACION
*
@DATAL   EQU   *
*
* ---------------------------------------------------------------------
*        DSECT DE PARAMETROS  CON CODIGOS DE LLAMADA/RETORNO
* ---------------------------------------------------------------------
$PARAM   DSECT
$CODIGO  DS    H            <> CODIGOS DE LLAMADA
*                               0   OBTIENE FECHA DEL DIA
*                               1   VERIFICACION/CONVERSION JULIANA
*                               2   VERIFICACION/CONVERSION GREGORIANA
*                               3   CONVERSION FECHA-BASE
*                           <> CODIGOS DE RETORNO
*                               0   FUNCION TERMINADA CORRECTAMENTE
*                              -1   CODIGO DE LLAMADA ERRONEO
*                              -2   FECHA(S) INVALIDA(S) O ILOGICA(S)
*
$FEGREGO DS    CL8'AAAAMMDD'
$FEJULIA DS    CL7'AAAADDD'
$FEBASE  DS    CL7'XXXXXXX'
$HORA    DS    CL2'XX'
$MINUTO  DS    CL2'XX'
$SEGUNDO DS    CL2'XX'
$DECIMAS DS    CL2'XX'
*
$IDIOMA  DS    CL4'XXXX'    <> CODIGOS DE IDIOMA
*                                 341 ---> CASTELLANO
*                                 343 ---> CATALAN------- FALTA
*                                 344 ---> VASCO--------- FALTA
*                                 3481 --> GALLEGO------- FALTA
*                                 33 ----> FRANCES
*                                 351 ---> PORTUGUES----- FALTA
*                                 39 ----> ITALIANO
*                                 44 ----> INGLES
*                                 49 ----> ALEMAN
$DIANUM  DS    CL2          <> DIA NUMERICO
$DIAALF  DS    CL20         <> DIA ALFABETICO
$MESNUM  DS    CL2          <> MES NUMERICO
$MESALF  DS    CL20         <> MES ALFABETICO
$ANONUM  DS    CL4          <> ANO NUMERICO
$ANOALF  DS    CL40         <> ANO ALFABETICO
$DIASEN  DS    CL1          <> DIA SEMANA NUMERICO (0=DOMINGO)
$DIASEA  DS    CL15         <> DIA DE LA SEMANA
*
$FEEDT1  DS    CL11'DD.MMM.AAAA'
$FEEDT2  DS    CL09'DD.MMM.AA'
$FEEDT3  DS    CL10'DD.MM.AAAA'
$FEEDT4  DS    CL08'DD.MM.AA'
*
$HOREDT  DS    CL11'HH:MM:SS:DD'
*
$HORBIN  DS    CL6
$HORALF  DS    CL44
*
         END
