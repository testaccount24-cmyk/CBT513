* +--- ZOS170D --------- MDFECHS -------------------------------------+
* |                                                                   |
* |  GGGGGG   MMM   MM  TTTTTTTT                11                    |
* | GGGGGGGG  MMM  MMM  TTTTTTTT      ++       111                    |
* | GG        MMMMMMMM     TT         ++      1111     AVISO          |
* | GG  GGGG  MM MM MM     TT       ++++++   11 11                    |
* | GG  GGGG  MM MM MM     TT       ++++++      11       IMPORTANTE   |
* | GG    GG  MM    MM     TT         ++        11                    |
* | GGGGGGGG  MM    MM     TT         ++    11111111                  |
* |  GGGGGG   MM    MM     TT               11111111                  |
* |                                                                   |
* |                                                                   |
* | PARA PODER OPERAR DE FORMA COMPLETA CON LA FUNCION DE "GMTEAR" UNA|
* | FECHA, ESTE MODULO NECESITA CONOCER EL DESPLAZAMIENTO DE LA HORA  |
* | LOCAL STANDARD PARA LA REGION DONDE ESA TRABAJANDO.               |
* |                                                                   |
* | EL MODULO LO CALCULA AUTOMATICAMENTE PARA TODAS LAS HORAS DEL A#O |
* | MENOS UNA, QUE ES PRECISAMENTE LA DEL CAMBIO DE HORA QUE SE       |
* | PRODUCE ANUALMENTE EL ULTIMO DOMINGO DE OCTUBRE. EL EL PERIODO    |
* | DE 02:00 A 03:00 DE ESE DIA ESTAMOS TRABAJANOD PRIMERO CON EL     |
* | LOCAL OFFSET DE VERANO Y A CONTINUACION, EN EL MISMO TRAMO, CON   |
* | EL LOCAL OFFSET DE INVIERNO.                                      |
* |                                                                   |
* | SI ESTA INICIALIZADA DISTINTO DE BLANCOS LA VARIABLE SETLOCAL     |
* | EL MODULO DEVOLVERA ESTA VARIABLE COMO DESPLAZAMIENTO SI ES       |
* | INVOCADO PRECISAMENTE EN ESA HORA Y SOLO DURANTE ESA HORA.        |
* |                                                                   |
* | SI LA VARIABLE ESTA A ESPACIOS (CUSTOMIZACION PARA CADA REGION)   |
* | EL MODULO DEVOLVERA UN CODIGO DE ERROR DICIENDO QUE ES IMPOSIBLE  |
* | CALCULAR EL DESPLAZAMIENTO.                                       |
* |                                                                   |
* +-------------------------------------------------------------------+
* | NOMBRE ....... MDFECHS                                            |
* |                ES UNA VERSION MEJORADA Y AMPLIADA DEL MDFECHA     |
* |                                                                   |
* | UBICACION .... LINKLIB   RENT, REUS,AMODE(31),RMODE(ANY)          |
* |                                                                   |
* | AUTOR ........ ANGEL LUIS DOMINGUEZ MARTIN. (C) 1992,2006         |
* |                                                                   |
* | FUNCIONES .... MODULO DE TRATAMIENTO, VERIFICACION Y CONVERSION   |
* |                DE FECHAS, OBTENCION DE FECHA/HORA DEL DIA,        |
* |                EDICION DE FECHA EN VARIOS FORMATOS Y DIA DE LA    |
* |                SEMANA, FECHAS RELIGIOSAS PARA UN ANO DADO Y       |
* |                FECHA ASTRONOMICA (JULIANA REAL SEGUN LA           |
* |                CONVENCION DEL OBSERVATORIO NAVAL DE LA NASA).     |
* |                                                                   |
* | OBJETIVOS .... LIBERAR A PROGRAMAS DEL TTO. DE FECHAS Y MEJORAR   |
* |                EL RENDIMIENTO DE MODULOS DE ESTE TIPO. PARA       |
* |                ELLO SE HA CODIFICADO DE FORMA RENT PARA FACILITAR |
* |                SU POSIBLE UBICACION EN LPA Y NO EFECTUA LLAMADAS  |
* |                EXTERNAS DEL TIPO GETMAIN O A OTROS MODULOS SALVO  |
* |                EN SITUACIONES ESPECIALES QUE ESTAN DOCUMENTADAS   |
* |                EN LOS PARAMETROS DE USO.                          |
* |                                                                   |
* | LENGUAJE ..... ASSEMBLER H.                                       |
* |                                                                   |
* | TIPO ......... MODULO                                             |
* |                                                                   |
* | PARAMETROS ... AREA PASADA POR EL PROGRAMA LLAMANTE               |
* |                VER LA DSECT $PARAM AL FINAL DEL FUENTE            |
* |                                                                   |
* | COD.LLAMADA    POSITIVOS:  FUNCIONES A REALIZAR                   |
* |                NEGATIVOS:  ERRORES O FECHAS INVALIDAS             |
* |                                                                   |
* +---+=================================+-----------------------------+
*     | SOBRE EL CONCEPTO DE FECHA-BASE |
* +---+=================================+-----------------------------+
* |                                                                   |
* | --> ENTENDEMOS POR FECHA-BASE EL DIA EN EL QUE ESTAMOS CONTANDO   |
* |     CORRELATIVA E HIPOTETICAMENTE DESDE EL 01-ENE-0001. TENDREMOS |
* |     UN VALOR EN LOS SIGUIENTES ORDENES DE MAGNITUD SEGUN FECHAS   |
* |                                                                   |
* |        01-01-0001 -  LUN -         1                              |
* |                                                                   |
* |        31-12-1992 -  JUE -   727.563                              |
* |        31-12-1993 -  VIE -   727.928                              |
* |        31-12-1994 -  SAB -   728.293                              |
* |        31-12-1995 -  DOM -   727.658                              |
* |        31-12-1996 -  MAR -   729.024                              |
* |        31-12-1997 -  MIE -   729.389                              |
* |        31-12-1998 -  JUE -   729.754                              |
* |        31-12-1999 -  VIE -   730.119                              |
* |        31-12-2000 -  DOM -   730.485                              |
* |        04-07-2006  - MAR -   732.496                              |
* |                                                                   |
* |        31-12-9999  - VIE - 3.652.059  (HEX 37B9DB)                |
* |                                                                   |
* |        24-03-22967 - MIE - 8.388.607  (HEX 7FFFFF)                |
* |                                                                   |
* | --> DE ESTO SE DESPRENDE QUE CON UN CAMPO HEXADECIMAL DE TRES     |
* |     POSICIONES, BINARIAMENTE POSITIVO, PODRIAN REPRESENTARSE      |
* |     TODAS LAS FECHAS ENTRE EL 01-ENE-0001 Y 24-03-22967, LO QUE   |
* |     PARECE SUFICIENTE INFORMATICAMENTE HABLANDO.                  |
* |                                                                   |
* | ------------------------------------------------------            |
* | CALCULO DE FECHA-BASE A PARTIR DE UNA JULIANA AAAA/DDD            |
* | ------------------------------------------------------            |
* |                                                                   |
* | SIENDO   D = DIA                                                  |
* |          T = ANO - 1                                              |
* |                                                                   |
* | FECHA-BASE = D + (T*365) + (T/4) - (T/100) + (T/400)              |
* |                                                                   |
* |                                                                   |
* +---+=================================================+-------------+
*     | SOBRE EL CONCEPTO DE FECHA-BASE SIGLOS XX Y XXI |
* +---+=================================================+-------------+
* |                                                                   |
* |     AQUELLAS APLICACIONES QUE NO REQUIERAN UNA DATACION QUE VAYA  |
* |     MAS ALLA DE LOS LIMITES DE LOS SIGLO XX O XXI, PUEDEN USAR    |
* |     ESTA FECHA BASE REDUCIDA CON EL CONSIGUIENTE AHORRO EN UN     |
* |     OCTETO.                                                       |
* |                                                                   |
* |     UTILIZANDO UN CAMPO BINARIO DE DOS POSICIONES, CON SIGNO      |
* |     ALCANZARIAMOS EL VALOR 32767 Y SIN SIGNO EL 65535.            |
* |                                                                   |
* |     CON EL VALOR 32767 PODRIAMOS DIRECCIONAR ALREDEDOR DE 89      |
* |     ANOS, MIENTRAS QUE CON 65535 SERIA EL DOBLE, ESTO ES, UNOS    |
* |     179 ANOS.                                                     |
* |                                                                   |
* |     SE TOMA COMO REFERENCIA DE COMIENZO DE SIGLO EL DIA PRIMERO   |
* |     DE ENERO DEL ANO 1 DEL PERIODO, ESTO ES, 1901 Y 2001.         |
* |                                                                   |
* +---+=================================================+-------------+
*     | SOBRE EL CONCEPTO DE FECHA LILIANA              |
* +---+=================================================+-------------+
* |                                                                   |
* |     ES EL MISMO CONCEPTO QUE FECHA BASE PERO TOMANDO COMO         |
* |     REFERENCIA LA FECHA DEL 14 DE OCTUBRE DE 1582 EN QUE SE       |
* |     PASO OFICIALMENTE EN MUCHOS PAISES DEL CALENDARIO JULIANO     |
* |     EL GREGORIANO.                                                |
* |                                                                   |
* +---+=================================================+-------------+
*     | SOBRE EL CONCEPTO DE FECHA ASTRONOMICA          |
* +---+=================================================+-------------+
* |                                                                   |
* |     SE HA ENTENDIDO POR FECHA JULIANA EL NUMERO DE DIAS QUE HAN   |
* |     TRANSCURRIDO DE UN ANO DADO, AUNQUE ESTE CONCEPTO DEBERIA     |
* |     LLAMARSE REALMENTE DIAS TRANSCURRIDOS DEL ANO.                |
* |     EL VERDADERO CONCEPTO DE FECHA JULIANA, QUE HEMOS CONSIGNADO  |
* |     AQUI COMO ASTRONOMICA SON LOS DIAS TRANSCURRIDOS DESDE UN     |
* |     PUNTO QUE SE FIJO MEDIANTE CALCULOS ASTRONOMICOS EN EL DIA    |
* |     01-01-4713 ANTES DE CRISTO. HAN TRANSCURRIDO, PUES, DESDE ESA |
* |     FECHA UNOS DOS MILLONES Y MEDIO DE DIAS. SE ASUME QUE LOS     |
* |     DIAS HAN TRNASCURRIDO SIN INTERRUPCION DESDE ESA FECHA EN     |
* |     PERIODO SEMANALES DE SIETE DIAS, AUNQUE HAYAN OCURRIDO        |
* |     HECHOS COMO EL PASO DEL CALENDARIO JULIANO AL GREGORIANO QUE  |
* |     SUPUSIERON ALTERACIONES.                                      |
* |     EN ESTE ESTADO DE COSAS, HAY DISCREPANCIAS ACERCA DE SI EL    |
* |     DIA COMIENZA EN EL MEDIODIA O EN LA MEDIANOCHE. ESTO ES       |
* |     IMPORTANTE DEBIDO A QUE LA FECHA JULIANA-ASTRONOMICA SE       |
* |     REPRESENTA CON FRACCION DECIMAL QUE INDICA LAS HORAS          |
* |     TRANSCURRIDAS DE UN DETERMINADO DIA.                          |
* |     EL CALCULO QUE SE HA EFECTUADO EN ESTE PROGRAMA SE            |
* |     CORRESPONDE CON EL OFRECIDO POR LA NASA EN LA WEB ASI         |
* |     COMO SUS INDICACIONES                                         |
* |                                                                   |
* |     HTTP://AA.USNO.NAVY.MIL/DATA/DOCS/JULIANDATE.HTML             |
* |                                                                   |
* |     TODO LO ANTERIOR EN MINUSCULAS EXCEPTO LA J Y LA D DE LA      |
* |     PALABRA JULIANDATE                                            |
* +---------------------------------- DOMINGUEZ (CL) 1992,2006 -------+
MDFECHS  CSECT
MDFECHS  AMODE     31
MDFECHS  RMODE     ANY
*
         YREGS
*
         USING     MDFECHS,R12         <> ESTABLECER DIRECCIONAMIENTO
         USING     MDFECHS+4096,R11    <> ESTABLECER DIRECCIONAMIENTO
         STM       R14,R12,12(R13)     <> STORE REGS SAVE ANTERIOR
         LR        R12,R15             <> CARGAR ENTRY POINT
         LR        R11,R12             <> SEGUNDO REGISTRO BASE
         LA        R11,2048(,R11)
         LA        R11,2048(,R11)
*
         B         INILB00
         DC        3F'0'
         DC        CL16'MDFECHS '
         DC        CL16'FENIX___ZOS170D_'
         DC        CL16'MODULO FECHAS___'
         DC        C'&SYSDATC.__&SYSTIME._'
         DC        C'(&SYSTEM_ID._&SYSASM._&SYSVER.)'
INILB00  DS        0D
*
         L         R2,0(,R1)           <> ADDR. PARAMETROS
         USING     $PARAM,R2           <> MAPA DE PARAMETROS
         LA        R3,$SAVESTA
         USING     @DYNDAT,R3          <> MAPA DE PARAMETROS
*
         LR        R10,R13             <> STORE SAVE ANTERIOR
         LA        R13,@DYNSAV         <> SAVE ACTUAL EN AREA RECIBIDA
         ST        R10,@DYNSAV+4       <> ENCADENAMIENTO DE SAVES
         ST        R13,8(R10)          <> ENCADENAMIENTO DE SAVES
*        +-----------------------------------+
*--------| CAMBIO DE ESTADO SI ES NECESARIO  |
*        | PARA EJECUTAR SIEMPRE EN AMODE 31 |
*        +-----------------------------------+
         SAM31
*        +------------------------------------------------+
*--------|  INICIALIZAMOS CEROS BINARIOS AREA DE TRABAJO  |
*        |  ENVIADA POR EL MODULO MENOS LA SAVEAREA       |
*        +------------------------------------------------+
         LA        R4,@DYNDAT          <> AREA DE TRABAJO
         LA        R5,@DYNDATL-@DYNSAVL
         LA        R15,0
         ICM       R15,B'1000',=X'EE'  <> RELLENO A X'EE'S
         MVCL      R4,R14              OBTENIDA
*        +--------------------------+
*--------|   DETECCION PARAMETROS   |
*        +--------------------------+
         LA        R1,0                <> CLEAR R1
         ICM       R1,B'0011',$CODIGO  <> CARGAR PARAMETRO
         CH        R1,KH0              <> TEST VALOR INFERIOR
         BL        PERR01              <> ERROR EN EL PARAMETRO
         CH        R1,KMNPARM          <> TEST VALOR SUPERIOR
         BNH       PR10                <> ERROR EN EL PARAMETRO
*
*        ERROR EN EL CODIGO DE LLAMADA
*
PERR01   DS        0H
         MVI       @WORKF,X'FF'
         MVC       @WORKF+1(L'@WORKF-1),@WORKF
         B         PERR99
*
PERR02   DS        0H
         MVI       @WORKF,X'FF'
         MVC       @WORKF+1(L'@WORKF-1),@WORKF
         MVI       @WORKF+L'@WORKF-1,X'FE'
         B         PERR99
*
PERR03   DS        0H
         MVI       @WORKF,X'FF'
         MVC       @WORKF+1(L'@WORKF-1),@WORKF
         MVI       @WORKF+L'@WORKF-1,X'FD'
         B         PERR99
*
PERR04   DS        0H
         MVI       @WORKF,X'FF'
         MVC       @WORKF+1(L'@WORKF-1),@WORKF
         MVI       @WORKF+L'@WORKF-1,X'FC'
         B         PERR99
*
PERR99   DS        0H
         MVC       $CODIGO,@WORKF+2
         L         R15,@WORKF
         B         ENDOFPGM
*
PR10     DS        0H
         MH        R1,KH4              <> CUATRO POSIC. BIFURCAC.
         LA        R15,PEJUMP          <> BASE DE SALTO
         B         0(R1,R15)           <> SALTO A RUTINA TTO.
PEJUMP   DS        0H
         B         PE00                <> FECHA DEL DIA
         B         PE01                <> VERIFICACION ANO BISIESTO
         B         PE02                <> OBTENER FECHAS RELIGIOSAS
         B         PE03                <> OFFSET HORA LOCAL
         B         PE04                <> GREGORIANA
         B         PE05                <> JULIANA
         B         PE06                <> BASE
         B         PE07                <> BASE SIGLO XX
         B         PE08                <> BASE SIGLO XXI
         B         PE09                <> ASTRONOMICA
         B         PE10                <> LILIANA
         B         PE11                <> GMT
         B         PE12                <> DIFERENCIA ENTRE DOS GREGORI.
*        +-----------------------------------------+----------+
*========|   OBTENCION DE LA FECHA DEL DIA LOCAL   | PE00     |
*        +-----------------------------------------+----------+
PE00     DS        0H
         BAS       R10,RTFA00          <> RUTINA FECHA ACTUAL
*
         MVC       @WGREGO,@WFACT      <> MOVER A GREGORIANA WORKA
         BAS       R10,RTGJ00          <> OBTENER LA JULIANA PARA LI
*
         MVC       $HORA,@WHACT
         MVC       $MINUTO,@WHACT+2
         MVC       $SEGUNDO,@WHACT+4
         MVC       $DECIMAS,@WHACT+6
*
         MVC       $HORBIN,@TIMEDAT
         MVC       $TIMESTA(8),@WFACT            <> TIMESTAMP GREGO
         UNPK      @WORK15(13),$HORBIN(7)
         MVC       $TIMESTA+8(12),@WORK15
*
         B         PELI00
*        +-----------------------------------------+----------+
*========|   VERIFICACION DE ANO BISIESTO          | PE01     |
*        +----------------------------------------------------+
*        | ESTA RUTINA DEVUELVE CONTROL SIN OBTENER LAS       |
*        | EXPANSIONES DE DATOS LITERALES                     |
*        +----------------------------------------------------+
PE01     DS        0H
         MVC       @WANO,$ANNO         <> VERIFICAR ANO
         TR        @WANO,TBTRNUM
         CLC       @WANO,$ANNO
         BNE       PERR02              <> INVALIDO
         PACK      @WBAAAA(3),$ANNO(5) <> ANO HEXADECIMAL SIN SIGNO
         BAS       R8,RTBI00           <> RUTINA BISIESTOS
         MVC       $INDBISI,@WBISI
         XC        $CODIGO,$CODIGO
         B         ENDOFPGM            <> DEVOLVER CONTROL
*        +-----------------------------------------+----------+
*========|   OBTENCION FECHAS RELIGIOSAS TEORICAS  | PE02     |
*        +-----------------------------------------+----------+
*        | ESTA RUTINA DEVUELVE CONTROL SIN OBTENER LAS       |
*        | EXPANSIONES DE DATOS LITERALES                     |
*        +----------------------------------------------------+
PE02     DS        0H
         MVC       @WANO,$ANNO         <> VERIFICAR ANO
         TR        @WANO,TBTRNUM
         CLC       @WANO,$ANNO
         BNE       PERR02              <> INVALIDO
         CLC       @WANO,=C'3399'      <> ANO TOPE
         BH        PERR02
*
         BAS       R9,RTFR00           <> RUTINA FECHAS RELIGIOSAS
*
         XC        $CODIGO,$CODIGO
         B         ENDOFPGM            <> DEVOLVER CONTROL
*        +-----------------------------------------+----------+
*========|   OBTENCION FECHA_HORA GMT Y OFFSET     | PE03     |
*        +-----------------------------------------+----------+
PE03     DS        0H
         BAS       R10,RTLO00
         MVC       $FEGREGO,@GMTSTAM
         MVC       $LOFFSET,@WLOFFSE
         MVC       $TIMESTA,@GMTSTAM
         MVC       $HORAFUL,@GMTSTAM+8
*
         MVC       @WGREGO,$FEGREGO
         BAS       R10,RTGJ00
*
         B         PELI00
*        +-----------------------------------------+----------+
*========|   GREGORIANA   VERIFICACION/CONVERSION  | PE04     |
*        +-----------------------------------------+----------+
PE04     DS        0H
         MVC       @WGREGO,$FEGREGO
         BAS       R10,RTVG00          <> VERIFICAR GREGORIANA
         BAS       R10,RTGJ00          <> CONVERTIR A JULIANA (BASELI)
         B         PELI00
*        +-----------------------------------------+----------+
*========|   JULIANA      VERIFICACION/CONVERSION  | PE05     |
*        +-----------------------------------------+----------+
PE05     DS        0H
         MVC       @WJULIA,$FEJULIA
         BAS       R10,RTVJ00          <> VERIFICAR JULIANA
         B         PELI00
*        +-----------------------------------------+----------+
*========|   BASE         VERIFICACION/CONVERSION  | PE06     |
*        +-----------------------------------------+----------+
PE06     DS        0H
         MVC       @WBASE,$FEBASE      <> VERIFICAR NUMERICOS
         TR        @WBASE,TBTRNUM
         CLC       @WBASE,$FEBASE
         BNE       PERR02              <> INVALIDO
         BAS       R10,RTBJ00
         B         PELI00              <> IR A OBTENER LITERALES
*        +-----------------------------------------+----------+
*========|   BASE SIGLO XX VERIFICACION/CONVERSION | PE07     |
*        +-----------------------------------------+----------+
PE07     DS        0H
         MVC       @WBASE,$FEBAS20
         TR        @WBASE,TBTRNUM
         CLC       @WBASE,$FEBAS20
         BNE       PERR02              <> INVALIDO
         PACK      @WORKD,@WBASE
         AP        @WORKD,=P'693960'
         UNPK      @WBASE,@WORKD
         OI        @WBASE+L'@WBASE-1,X'F0'
         BAS       R10,RTBJ00
         B         PELI00              <> IR A OBTENER LITERALES
*        +-----------------------------------------+----------+
*========|  BASE SIGLO XXI VERIFICACION/CONVERSION | PE07     |
*        +-----------------------------------------+----------+
PE08     DS        0H
         MVC       @WBASE,$FEBAS21
         TR        @WBASE,TBTRNUM
         CLC       @WBASE,$FEBAS21
         BNE       PERR02              <> INVALIDO
         PACK      @WORKD,@WBASE
         AP        @WORKD,=P'730485'
         UNPK      @WBASE,@WORKD
         OI        @WBASE+L'@WBASE-1,X'F0'
         BAS       R10,RTBJ00
         B         PELI00              <> IR A OBTENER LITERALES
*        +-----------------------------------------+----------+
*========|   ASTRONOMICA  VERIFICACION/CONVERSION  | PE09     |
*        +-----------------------------------------+----------+
PE09     DS        0H
         MVC       @WASTRO,$FEASTRO
         TR        @WASTRO,TBTRNUM
         CLC       @WASTRO,$FEASTRO
         BNE       PERR02              <> INVALIDO
         CLC       $FEASTRO(7),=C'2305814'    <> ADMITIDAS ENTRE
         BL        PERR02
         CLC       $FEASTRO(7),=C'2962884'    <> ADMITIDAS ENTRE
         BH        PERR02
         BAL       R10,RTAG00          <> CONVERTIR A GREGORIANA
         BAL       R10,RTGJ00          <> CONVERTIR A JULIANA
         B         PELI00              <> IR A OBTENER LITERALES
*        +-----------------------------------------+----------+
*========|   LILIANA      VERIFICACION/CONVERSION  | PE10     |
*        +-----------------------------------------+----------+
PE10     DS        0H
         MVC       @WBASE,$FELILIA     <> VERIFICAR NUMERICOS
         TR        @WBASE,TBTRNUM
         CLC       @WBASE,$FELILIA
         BNE       PERR02              <> INVALIDO
         PACK      @WORKD,@WBASE
         AP        @WORKD,=P'577734'
         UNPK      @WBASE,@WORKD
         OI        @WBASE+L'@WBASE-1,X'F0'
         BAS       R10,RTBJ00
         B         PELI00              <> IR A OBTENER LITERALES
*        +-----------------------------------------+----------+
*========|   "GMTEAR"     VERIFICACION/CONVERSION  | PE11     |
*        +-----------------------------------------+----------+
*        | ESTA RUTINA DEVUELVE CONTROL SIN OBTENER LAS       |
*        | EXPANSIONES DE DATOS LITERALES                     |
*        +----------------------------------------------------+
PE11     DS        0H
         MVC       @WGMT,$FEGMT
         TR        @WGMT,TBTRNUM
         CLC       @WGMT,$FEGMT
         BNE       PERR02              <> INVALIDO
         CLC       @WGMT+8(2),=C'23'   <> VERIFICAR HORAS
         BH        PERR02
         CLC       @WGMT+10(2),=C'59'  <> VERIFICAR HORAS
         BH        PERR02
*
         BAS       R10,RTFA00          <> RUTINA FECHA ACTUAL
         MVC       @LOCSTAM(8),@WFACT
         UNPK      @WORK15(13),@TIMEDAT(7)
         MVC       @LOCSTAM+8(12),@WORK15
*
         BAS       R10,RTLO00          <> OFFSET ACTUAL Y @GMTSTAM
         PACK      @WOFFBAS,@WLOFFSE+1(6)
         CLI       @WLOFFSE,C'E'       <> POSITIVO ?
         BE        *+4+6
         MVN       @WOFFBAS+L'@WOFFBAS-1,=X'0D'  <> PONER NEGATIVO
*
*        CALCULAR FECHA Y HORA DEL CAMBIO A VERANO PARA LA GMT
*        =====================================================
         MVC       @WGREGO(4),@LOCSTAM <> ANO LOCAL
         MVC       @WGREGO+4(4),KVERFEC1         <> COMIENZO HOR.VERANO
         BAS       R10,RTGJ00          <> CONVERTIR A JULIANA
         BAS       R10,RTJB00          <> CONVERTIR A BASE
         BAS       R10,RTDS00          <> DIA LA SEMANA
         PACK      @WORKF,@WBASE       <> DIA BASE
         PACK      @WORKH,@WDIASEN     <> DIA DE LA SEMANA NUMERICO
         SP        @WORKF,@WORKH       <> CALCULAR ULT.DOMINGO DEL MES
         UNPK      @WBASE,@WORKF
         OI        @WBASE+L'@WBASE-1,X'F0'       <> WBASE ULT. DOMINGO
         BAS       R10,RTBJ00          <> PASAR A JULIANA
         BAS       R10,RTJG00          <> PASAR A GREGORIANA
         MVC       @WLOC1PE(8),@WGREGO           <> FECHA DE VERANO
         MVC       @WLOC1PE+8(4),KVERHOR1        <> HORA DE VERANO
*
*        CALCULAR FECHA Y HORA DEL CAMBIO A INVIERNO PARA LA GMT
*        =====================================================
         MVC       @WGREGO(4),@LOCSTAM <> ANO EN TRATAMIENTO
         MVC       @WGREGO+4(4),KVERFEC2         <> COMIENZO HOR.VERANO
         BAS       R10,RTGJ00          <> CONVERTIR A JULIANA
         BAS       R10,RTJB00          <> CONVERTIR A BASE
         BAS       R10,RTDS00          <> DIA LA SEMANA
         PACK      @WORKF,@WBASE       <> DIA BASE
         PACK      @WORKH,@WDIASEN     <> DIA DE LA SEMANA NUMERICO
         SP        @WORKF,@WORKH       <> CALCULAR ULT.DOMINGO DEL MES
         UNPK      @WBASE,@WORKF
         OI        @WBASE+L'@WBASE-1,X'F0'       <> WBASE ULT. DOMINGO
         BAS       R10,RTBJ00          <> PASAR A JULIANA
         BAS       R10,RTJG00          <> PASAR A GREGORIANA
         MVC       @WLOC2PE(8),@WGREGO           <> FECHA DE VERANO
         MVC       @WLOC2PE+8(4),KVERHOR2        <> HORA DE VERANO
*
*        CALCULAR FECHA Y HORA DEL CAMBIO A INVIERNO PARA LA GMT
*        =====================================================
         MVC       @WLOCHPE,@WLOC2PE             <> CAMBIO A INVIERNO
         MVC       @WLOCHPE+8(4),KVERCAMB        <> HORA DE CAMBIO
*
*        VER SI EL OFFSET CALCULADO ES DE VERANO O DE INVIERNO
*        O ESTA EN LA HORA DEL CAMBIO DE VERANO A INVIERNO
*
         CLC       @LOCSTAM(L'@WGMT),@WLOC1PE
         BL        PE11PR10            <> ES EL OFFSET DE INVIERNO
         CLC       @LOCSTAM(L'@WGMT),@WLOC2PE
         BNL       PE11PR10            <> ES EL OFFSET DE INVIERNO
         CLC       @LOCSTAM(L'@WGMT),@WLOCHPE
         BNL       PE11HCAM            <> ES LA HORA DL CAMBIO
         B         PE11OFVE            <> ES HORARIO DE VERANO
*
PE11OFVE DS        0H
         SP        @WOFFBAS,=P'10000'  <> QUITAR UNA HORA (HHMMSS)
         B         PE11PR10            <> CONTINUAR PROCESO
*
*        TTO. ESPECIAL CUANDO ESTAMOS EN LA HORA EN QUE SE PRODUCE
*        EL CAMBIO DE VERANO A INVIERNO.
*        VER COMENTARIO AL PRINCIPIO DE ESTE PROGRAMA
*
PE11HCAM DS        0H
         CLC       SETLOCAL,BLANCOS    <> HAY VALOR DE INSTALACION ?
         BE        PERR04              <> NO ERROR -4
         PACK      @WOFFBAS,SETLOCAL+1(6)
         CLI       SETLOCAL,C'E'       <> POSITIVO ?
         BE        *+4+6
         MVN       @WOFFBAS+L'@WOFFBAS-1,=X'0D'  <> PONER NEGATIVO
         B         PE11PR10            <> CONTINUAR PROCESO
*        ----------------------------
*        EN ESTE PUNTO TENEMOS EN @WOFFBAS CON SIGNO EL VALOR BASICO DE
*        LA INSTALACION COMO DESPLAZAMIENTO BASICO EN INVIERNO
*        ----------------------------
*
*        CALCULAR FECHA/HORA DEL CAMBIO A VERANO PARA LA FECHA PEDIDA
*        ============================================================
PE11PR10 DS        0H
         MVC       @WGREGO(4),@WGMT    <> ANO EN TRATAMIENTO
         MVC       @WGREGO+4(4),KVERFEC1         <> COMIENZO HOR.VERANO
         BAS       R10,RTGJ00          <> CONVERTIR A JULIANA
         BAS       R10,RTJB00          <> CONVERTIR A BASE
         BAS       R10,RTDS00          <> DIA LA SEMANA
         PACK      @WORKF,@WBASE       <> DIA BASE
         PACK      @WORKH,@WDIASEN     <> DIA DE LA SEMANA NUMERICO
         SP        @WORKF,@WORKH       <> CALCULAR ULT.DOMINGO DEL MES
         UNPK      @WBASE,@WORKF
         OI        @WBASE+L'@WBASE-1,X'F0'       <> WBASE ULT. DOMINGO
         BAS       R10,RTBJ00          <> PASAR A JULIANA
         BAS       R10,RTJG00          <> PASAR A GREGORIANA
         MVC       @WLOC1PE(8),@WGREGO           <> FECHA DE VERANO
         MVC       @WLOC1PE+8(4),KVERHOR1        <> HORA DE VERANO
*
*        CALCULAR FECHA/HORA DEL CAMBIO A INVIERNO PARA LA FECHA PEDIDA
*        ==============================================================
         MVC       @WGREGO(4),@WGMT    <> ANO EN TRATAMIENTO
         MVC       @WGREGO+4(4),KVERFEC2         <> COMIENZO HOR.VERANO
         BAS       R10,RTGJ00          <> CONVERTIR A JULIANA
         BAS       R10,RTJB00          <> CONVERTIR A BASE
         BAS       R10,RTDS00          <> DIA LA SEMANA
         PACK      @WORKF,@WBASE       <> DIA BASE
         PACK      @WORKH,@WDIASEN     <> DIA DE LA SEMANA NUMERICO
         SP        @WORKF,@WORKH       <> CALCULAR ULT.DOMINGO DEL MES
         UNPK      @WBASE,@WORKF
         OI        @WBASE+L'@WBASE-1,X'F0'       <> WBASE ULT. DOMINGO
         BAS       R10,RTBJ00          <> PASAR A JULIANA
         BAS       R10,RTJG00          <> PASAR A GREGORIANA
         MVC       @WLOC2PE(8),@WGREGO           <> FECHA DE VERANO
         MVC       @WLOC2PE+8(4),KVERHOR2        <> HORA DE VERANO
*
*        DESCONTAR EL OFFSET HALLADO A LA FECHA SOLICITADA
*
         MVC       @WGREGO,@WGMT       <> FECHA QUE WUEREMOS GMTEAR
         BAS       R10,RTGJ00          <> PASAR A JULIANA
         BAS       R10,RTJB00          <> PASAR A BASE
         PACK      @WORKD,@WBASE       <> EMPAQUETAR
         SP        @WORKD,=P'1'        <> RESTAR UN DIA
         MP        @WORKD,=P'10000'    <> DEJAR HUECO HH:MM
         AP        @WORKD,=P'2400'     <> 24 HORAS DEL DIA DISMINUIDO
         PACK      @WORKF,@WGMT+8(4)   <> HH:MM SOLICITADOS
         AP        @WORKD,@WORKF       <> SUMAR
*
*        EL OFFSET BASICO (@WOFFBAS) ESTA EN FORMATO HHMMSS
*        AL GMTEAR LA HORA NO TRABAJAMOS CON SEGUNDOS
*
         MVN       @WOFFBAS+L'@WOFFBAS-2,@WOFFBAS+L'@WOFFBAS-1
*
         SP        @WORKD,@WOFFBAS(L'@WOFFBAS-1)
*
*        VER SI LA FECHA/HORA PEDIDA ES DE INVIERNO O DE VERANO
*
         CLC       @WGMT,@WLOC1PE
         BL        PE11PR20            <> ES EL OFFSET DE INVIERNO
         CLC       @WGMT,@WLOC2PE
         BNL       PE11PR20            <> ES EL OFFSET DE VERANO
*
         SP        @WORKD,=P'100'      <> RESTAR UNA HORA MAS
*
PE11PR20 DS        0H                   <> OFFSET DE INVIERNO
         UNPK      @WGMT,@WORKD
         OI        @WGMT+L'@WGMT-1,X'F0'
*
         ZAP       @WORKF,@WORKD+5(3)   <> TRATAR LAS HORAS
         MVZ       @WORKF+1(1),=X'00'   <> MACHACAR EL CERO IZQUIERDO
         CP        @WORKF,=P'2400'
         BL        PE11PR30             <> ESTA BIEN
         SP        @WORKD,=P'2400'      <> QUITAR LAS 24:00
         AP        @WORKD,=P'10000'     <> Y SUMAR UN DIA
PE11PR30 DS        0H
         UNPK      @WGMT,@WORKD         <> DESEMPAQUETAR LOS VALORES
         OI        @WGMT+L'@WGMT-1,X'F0'         <> SIGNO
         MVC       @WBASE,@WGMT+1       <> ENTRESACAR LA FECHA BASE
         BAS       R10,RTBJ00           <> CONVERTIR A JULIANA
         BAS       R10,RTJG00           <> CONVERTIR A GREGORIANA
*
         MVC       @WGMT(8),@WGREGO
         MVC       $FEGMT,@WGMT
*
         XC        $CODIGO,$CODIGO
         B        ENDOFPGM              <> DEVOLVER CONTROL
*        +-----------------------------------------+----------+
*========|   DIFERENCIA ENTRE DOS FECHAS GREGORIA  | PE12     |
*        +-----------------------------------------+----------+
PE12     DS        0H
         MVC       @WGREGO,$FEGREGO
         BAS       R10,RTVG00          <> VERIFICAR GREGORIANA
         BAS       R10,RTGJ00          <> CONVERTIR A JULIANA
         BAS       R10,RTJB00          <> CONVERTIR A BASE
         PACK      @WDIFER,@WBASE      <> GUARDAR BASE DE FECHA-1
         MVC       @WGREGO,$FEGREG2
         BAS       R10,RTVG00          <> VERIFICAR GREGORIANA
         BAS       R10,RTGJ00          <> CONVERTIR A JULIANA
         BAS       R10,RTJB00          <> CONVERTIR A BASE
         PACK      @WORKD,@WBASE       <> GUARDAR BASE DE FECHA-2
         SP        @WORKD,@WDIFER      <> RESTAR FECHAS
         CVB       R1,@WORKD           <> PASAR A BINARIO CON SIGNO
         STCM      R1,B'1111',$FEDIFER <> DIFERENCIA A PARAMETRO
*
         XC        $CODIGO,$CODIGO
         B         ENDOFPGM              <> DEVOLVER CONTROL
*        +-----------------------------------------+----------+
*>>>>>>>>| OBTENCION DE DATOS EN LITERALES         |          |<<<<<<<<
*        +-----------------------------------------+----------+
*        | OBTIENE LOS RESULTADOS SOLICITADOS A PARTIR DE     |
*        | LOS DATOS QUE HA RECIBIDO                          |
*        +----------------------------------------------------+
PELI00   DS        0H
         CLC       $OBTIPOS,BLANCOS    <> ALGUNA SOLICITUD
         BE        PELI99
*
         CLI       $OB@BISI,C'S'       <> OBTENER ANO BISIESTO
         BNE       PELI0B
*
*        <OBTENCION----> BISIESTO
*
         MVC       $INDBISI,@WBISI     <> POR DEFECTO LO QUE HAYA
         CLI       $INDBISI,X'EE'      <> YA ESTABA OBTENIDO?
         BNE       PELI0B              <> SI, SIGUIENTE PETICION
         PACK      @WBAAAA(3),@WJULIA(5)  ANO HEXADECIMAL SIN SIGNO
         BAS       R8,RTBI00
         MVC       $INDBISI,@WBISI     <> LO NUEVO A SALIDA
*
PELI0B   DS        0H
         CLI       $OB@RELI,C'S'
         BNE       PELI0C
*
*        <OBTENCION----> FECHAS RELIGIOSAS
*
         MVC       @WANO,@WJULIA       <> CONSIGNAR ANNO TRABAJO
         CLC       @WANO,=C'3399'      <> ANO MAXIMO
         BH        PERR03              <> ERROR
*
         MVC       @SAVABAS,@AREABAS
         BAS       R9,RTFR00
         MVC       @AREABAS,@SAVABAS
*
PELI0C   DS        0H
         CLI       $OB@GREG,C'S'
         BNE       PELI0D
*
*        <OBTENCION----> GREGORIANA
*
         MVC       $FEGREGO,@WGREGO
         CLI       $FEGREGO,X'EE'      <> YA LA TENEMOS?
         BNE       PELI0D              <> SALTAR
*
         BAS       R10,RTJG00          <> CONVERTIR A GREGORIANA
         MVC       $FEGREGO,@WGREGO    <> ASIGNARLA
*
PELI0D   DS        0H
         CLI       $OB@JULI,C'S'
         BNE       PELI0E
*
*        <OBTENCION----> JULIANA
*
         MVC       $FEJULIA,@WJULIA
         CLI       $FEJULIA,X'EE'      <> YA LA TENEMOS?
         BNE       PELI0E              <> SALTAR
*
         ABEND     777,DUMP            <> LA JULIANA ESTA SIEMPRE
*
PELI0E   DS        0H
         CLI       $OB@BASE,C'S'
         BNE       PELI0F
*
*        <OBTENCION----> FECHA BASE
*
         MVC       $FEBASE,@WBASE
         CLI       $FEBASE,X'EE'       <> YA LA TENEMOS?
         BNE       PELI0F              <> SALTAR
*
         BAS       R10,RTJB00          <> OBTENER FECHA BASE
         MVC       $FEBASE,@WBASE
*
PELI0F   DS        0H
         CLI       $OB@BAS0,C'S'
         BNE       PELI0G
*
*        <OBTENCION----> FECHA BASE SIGLO XX
*
         CLI       @WBASE,X'EE'        <> TENEMOS BASE REAL ?
         BE        PELI0F10            <> SI, A CALCULAR SIGLO XX
         BAS       R10,RTJB00          <> CALCULAR BASE
*
PELI0F10 DS        0H
         PACK      @WORKD(4),@WBASE
         SP        @WORKD(4),=P'693960'
         UNPK      $FEBAS20,@WORKD(4)
         OI        $FEBAS20+L'$FEBAS20-1,X'F0'
*
PELI0G   DS        0H
         CLI       $OB@BAS1,C'S'
         BNE       PELI0H
*
*        <OBTENCION----> FECHA BASE SIGLO XXI
*
         CLI       @WBASE,X'EE'        <> TENEMOS BASE REAL ?
         BE        PELI0G10            <> SI, A CALCULAR SIGLO XXO
         BAS       R10,RTJB00          <> CALCULAR BASE
*
PELI0G10 DS        0H
         PACK      @WORKD(4),@WBASE
         SP        @WORKD(4),=P'730485'
         UNPK      $FEBAS21,@WORKD(4)
         OI        $FEBAS21+L'$FEBAS21-1,X'F0'
*
PELI0H   DS        0H
         CLI       $OB@ASTR,C'S'
         BNE       PELI0I         <<<<< OJO PENDIENTE
*
*        <OBTENCION----> FECHA ASTRONOMICA
*
         CLI       @WASTRO,X'EE'       <> YA LA TENEMOS
         BNE       PELI0H10
*
         CLI       @WGREGO,X'EE'       <> TENEMOS LA GREGORIANA ?
         BNE       *+4+4
         BAL       R10,RTJG00          <> HALLAR LA GREGORIANA
* ====>
         BAL       R10,RTGA00          <> HALLAR LA ASTRONOMICA
*
PELI0H10 DS        0H
         MVC       $FEASTRO,@WASTRO
         MVC       $FEASTRO+7(4),CEROS <> POR EL MOMENTO SIN DECIMALES
*
PELI0I   DS        0H
         CLI       $OB@LILI,C'S'
         BNE       PELI0J
*
*        <OBTENCION----> FECHA LILIANA
*
         CLI       @WBASE,X'EE'        <> TENEMOS BASE REAL ?
         BE        PELI0I10            <> SI, A CALCULAR SIGLO XXO
         BAS       R10,RTJB00          <> CALCULAR BASE
*
PELI0I10 DS        0H
         PACK      @WORKD(4),@WBASE
         SP        @WORKD(4),=P'577734'
         UNPK      $FELILIA,@WORKD(4)
         OI        $FELILIA+L'$FELILIA-1,X'F0'
*
PELI0J   DS        0H
         CLI       $OB@EDT,C'S'
         BNE       PELI0K
*                  * --
*        <OBTENCION----> FECHAS EDITADAS Y OTROS VALORES
*
*        SELECCION DE TABLA DE IDIOMA A UTILIZAR
*
         LA        R1,TBIDIOMA
PELI0J10 DS        0H
         CLI       0(R1),C'*'          <> FIN DE TABLA, IDIOM DEFECTO
         BE        PELI0J12
         CLC       0(4,R1),$IDIOMA
         BE        PELI0J12
         LA        R1,8(,R1)           <> SIGUIENTE ENTRADA EN TABLA
         B         PELI0J10
PELI0J12 DS        0H
         MVC       @ADRIDIO,4(R1)      <> DIRECCION TABLA IDIOMA
*
         CLI       @WBASE,X'EE'             <> TENEMOS FECHA BASE
         BNE       PELI0J20
         BAS       R10,RTJB00          <> OBTENER FECHA BASE
PELI0J20 DS        0H
         BAS       R10,RTDS00 <> OBTENER DIA SEMANA
         MVC       $DIASEN,@WDIASEN         <> DIA SEMANA NUMERICO
         MVC       @WBSS,$DIASEN            <> PASAR A BINARIO
         MVZ       @WBSS,=X'00'             <> EL DIA SEMANA NUMERICO
         L         R1,@ADRIDIO              <> TABLA DEL IDIOMA
         L         R1,4(,R1)                <> TABLA DE DIAS SEMANA
         LA        R15,0
         ICM       R15,B'0001',@WBSS        <> DIA CALCULADO
         MH        R15,0(R1)                <> TAMANO DE CADA ENTRADA
         LA        R14,0
         LH        R14,0(R1)                <> GUARDA.TAMANO CADA ENTR
         AR        R1,R15
         LA        R1,2(,R1)                <> DIRECCIONA AL DATO
         BCTR      R14,R0                   <> UNO MENOS PARA EXECUTE
         MVC       $DIASEA,BLANCOS
         EX        R14,MVCDIASE             <> MOVER DIA DE LA SEMANA
         B         PELI0J30
MVCDIASE MVC       $DIASEA(0),0(R1)         <> MUEVE DIA DE LA SEMAMA
PELI0J30 DS        0H
         MVC       $DIANUM,$FEGREGO+6       <> DIA NUMERICO
         L         R1,@ADRIDIO              <> TABLA DEL IDIOMA
         L         R1,0(,R1)                <> TABLA DE DIAS ALFABETICA
         PACK      @WORKD,$DIANUM
         CVB       R15,@WORKD               <> PASAR DIAS A BINARIO
         BCTR      R15,R0                   <> RESTAR UNO
         MH        R15,0(R1)                <> TAMANO DE CADA ENTRADA
         LA        R14,0
         LH        R14,0(R1)                <> GUARD TAMANO CADA ENTRA
         AR        R1,R15
         LA        R1,2(,R1)                <> DIRECCIONA AL DATO
         BCTR      R14,R0                   <> UNO MENOS PARA EXECUTE
         MVC       $DIAALF,BLANCOS
         EX        R14,MVCDIAAL             <> MOVER DIA ALFABETICO
         B         PELI0J40
MVCDIAAL MVC       $DIAALF(0),0(R1)         <> MUEVE DIA ALFABETICO
PELI0J40 DS        0H
         MVC       $MESNUM,$FEGREGO+4       <> MES NUMERICO
         L         R1,@ADRIDIO              <> TABLA DEL IDIOMA
         L         R1,12(,R1)               <> TABLA DE MES LARGO
         PACK      @WORKD,$MESNUM
         CVB       R15,@WORKD               <> PASAR DIAS A BINARIO
         BCTR      R15,R0                   <> RESTAR UNO
         MH        R15,0(R1)                <> TAMANO DE CADA ENTRADA
         LA        R14,0
         LH        R14,0(R1)                <> GUARD TAMANO CADA ENTRA
         AR        R1,R15
         LA        R1,2(,R1)                <> DIRECCIONA AL DATO
         BCTR      R14,R0                   <> UNO MENOS PARA EXECUTE
         MVC       $MESALF,BLANCOS
         EX        R14,MVCMESAL             <> MOVER MES ALFABETICO
         B         PELI0J50
MVCMESAL MVC       $MESALF(0),0(R1)         <> MUEVE MES ALFABETICO
PELI0J50 DS        0H
         MVC       $ANONUM,$FEGREGO         <> ANO NUMERICO
         MVC       $ANOALF,BLANCOS          <> ANO ALFABETICO
         L         R1,@ADRIDIO              <> TABLA DEL IDIOMA
         L         R1,8(,R1)                <> TABLA DE MES CORTO
         PACK      @WORKD,$FEGREGO+4(2)
         CVB       R15,@WORKD               <> PASAR DIAS A BINARIO
         BCTR      R15,R0                   <> RESTAR UNO
         MH        R15,0(R1)                <> TAMANO DE CADA ENTRADA
         AR        R1,R15
         LA        R1,2(,R1)                <> DIRECCIONA AL DATO
*
         MVC       $FEEDT1(2),$FEGREGO+6
         MVI       $FEEDT1+2,C'.'
         MVC       $FEEDT1+3(3),0(R1)
         MVI       $FEEDT1+6,C'.'
         MVC       $FEEDT1+7(4),$FEGREGO
*
         MVC       $FEEDT2(7),$FEEDT1
         MVC       $FEEDT2+7(2),$FEEDT1+9
*
         MVC       $FEEDT3(2),$FEGREGO+6
         MVI       $FEEDT3+2,C'.'
         MVC       $FEEDT3+3(2),$FEGREGO+4
         MVI       $FEEDT3+5,C'.'
         MVC       $FEEDT3+6(4),$FEGREGO
*
         MVC       $FEEDT4(6),$FEEDT3
         MVC       $FEEDT4+6(2),$FEEDT3+8
*
         CLI       $CODIGO+1,X'00'
         BNE       PELI0K              <> SALTAR CAMPO SIGUIENTE
         MVI       $HOREDT,C':'
         MVC       $HOREDT+1(L'$HOREDT-1),$HOREDT
         MVC       $HOREDT(2),$HORA
         MVC       $HOREDT+3(2),$MINUTO
         MVC       $HOREDT+6(2),$SEGUNDO
         MVC       $HOREDT+9(2),$DECIMAS
*
         MVI       $HORALF,C' '
         MVC       $HORALF+1(L'$HORALF-1),$HORALF
*
PELI0K   DS        0H
         CLI       $OB@EDTH,C'S'
         BNE       PELI0L
*
*        <OBTENCION----> EDITAR LA HORA
*
         CLI       $CODIGO+1,X'00'     <> NOS HAN PEDIDO LA HORA ?
         BNE       PELI0L              <> NO, SALTAR ESTA OBTENCION
*
*        HORAS
*
         LA        R6,@CANAREA
         USING     $CANPARM,R6
         XC        $CANCOD,$CANCOD     <> GENERO FEMENINO
         MVI       $CANPENT,C'0'
         MVC       $CANPENT+1(L'$CANPENT-1),$CANPENT
         MVC       $CANPENT+L'$CANPENT-2(2),@WHACT
         MVC       $CANPDEC,CEROS      <> SIN DECIMALES
         MVC       $CANTROC,=C'080999' <> TROCEAMIENTO DE LIETERALES
         MVI       $CANLITE,C' '
         MVC       $CANLITE+1(L'$CANLITE-1),$CANLITE
         MVC       $CANLITE(10),=C'HORA/HORAS'
         LINK      EP=MDCANTI,PARAM=((R6))
*
         MVC       $HORALF,$CANLITE    <> MOVER A CAMPO PARAMETROS
         LA        R5,$HORALF+L'$HORALF-1 DIRECCIONAR FIN DE CAMPO
PELI0K10 DS        0H
         CLI       0(R5),C'*'          <> BUSCAR EL PRIMER ASTERISCO
         BNE       *+4+4   =========+
         BCT       R5,PELI0K10      |
* ====>                      <======+
         LA        R5,1(R5)            <> AVANZAR LA POSICION
         MVI       0(R5),C' '          <> MOVER UN ESPACIO
         LA        R5,1(R5)            <> AVANZAR LA POSICION
*
*        MINUTOS
*
         XC        $CANCOD,$CANCOD
         MVI       $CANCOD+1,X'01'     <> MINUTOS MASCULINO
         MVI       $CANPENT,C'0'
         MVC       $CANPENT+1(L'$CANPENT-1),$CANPENT
         MVC       $CANPENT+L'$CANPENT-2(2),@WHACT+2
         MVC       $CANPDEC,CEROS      <> SIN DECIMALES
         MVC       $CANTROC,=C'080999' <> TROCEAMIENTO DE LITERALES
         MVI       $CANLITE,C' '
         MVC       $CANLITE+1(L'$CANLITE-1),$CANLITE
         MVC       $CANLITE(14),=C'MINUTO/MINUTOS'
         LINK      EP=MDCANTI,PARAM=((R6))
*
         LR        R15,R5              <> POSIC. EN EL AREA SALIDA
         LA        R1,$HORALF+L'$HORALF   FINAL DEL CAMPO
         SR        R1,R15              <> POSICIONES RESTANTES
         BCTR      R1,R0               <> UNA MENOS PARA MOVE
         EX        R1,PELI0KMV         <> MOVER VARIABLE
*
         LA        R5,$HORALF+L'$HORALF-1 DIRECCIONAR FIN DE CAMPO
PELI0K20 DS        0H
         CLI       0(R5),C'*'          <> BUSCAR EL PRIMER ASTERISCO
         BNE       *+4+4
         BCT       R5,PELI0K20
* ====>
         LA        R5,1(R5)            <> AVANZAR LA POSICION
         MVI       0(R5),C' '          <> MOVER UN ESPACIO
         LA        R5,1(R5)            <> AVANZAR LA POSICION
*
*        SEGUNDOS
*
         XC        $CANCOD,$CANCOD
         MVI       $CANCOD+1,X'01'     <> MINUTOS MASCULINO
         MVI       $CANPENT,C'0'
         MVC       $CANPENT+1(L'$CANPENT-1),$CANPENT
         MVC       $CANPENT+L'$CANPENT-2(2),@WHACT+4
         MVC       $CANPDEC,CEROS      <> SIN DECIMALES
         MVC       $CANTROC,=C'080999' <> TROCEAMIENTO DE LITERALES
         MVI       $CANLITE,C' '
         MVC       $CANLITE+1(L'$CANLITE-1),$CANLITE
         MVC       $CANLITE(16),=C'SEGUNDO/SEGUNDOS'
         LINK      EP=MDCANTI,PARAM=((R6))
*
         LR        R15,R5              <> POSIC. EN EL AREA SALIDA
         LA        R1,$HORALF+L'$HORALF   FINAL DEL CAMPO
         SR        R1,R15              <> POSICIONES RESTANTES
         BCTR      R1,R0               <> UNA MENOS PARA MOVE
         EX        R1,PELI0KMV         <> MOVER VARIABLE
*
         B         PELI0L
*
PELI0KMV MVC       0(0,R5),$CANLITE    <> MOVE VARIABLE
*
         DROP      R6
PELI0L   DS        0H
         CLI       $OB@EDTA,C'S'
         BNE       PELI99
*
*        <OBTENCION----> EDITAR EL ANO
*
         LA        R6,@CANAREA
         USING     $CANPARM,R6
         XC        $CANCOD,$CANCOD
         MVI       $CANCOD+1,X'01'     <> GENERO MASCULINO
         MVI       $CANPENT,C'0'
         MVC       $CANPENT+1(L'$CANPENT-1),$CANPENT
         MVC       $CANPENT+L'$CANPENT-4(4),@WJULIA
         MVC       $CANPDEC,CEROS      <> SIN DECIMALES
         MVC       $CANTROC,=C'080999' <> TROCEAMIENTO DE LIETERALES
         MVI       $CANLITE,C' '
         MVC       $CANLITE+1(L'$CANLITE-1),$CANLITE
         LINK      EP=MDCANTI,PARAM=((R6))
*
         MVC       $ANOALF,$CANLITE
*
         LA        R5,$ANOALF+L'$ANOALF-1 DIRECCIONAR FIN DE CAMPO
PELI0L10 DS        0H
         CLI       0(R5),C'*'          <> BUSCAR EL PRIMER ASTERISCO
         BNE       *+4+4
         BCT       R5,PELI0L10
* ====>
         BCTR      R5,R0 <> CASO ESPECIAL ANOS UNO
         BCTR      R5,R0
         CLC       0(4,R5),=C' UN*'    <> AVANZAR LA POSICION
         BNE       *+4+4               <> MOVER UN ESPACIO
         MVI       3(R5),C'O'          <> PONER UNO
*
         DROP      R6
*
PELI99   DS        0H
         XC        $CODIGO,$CODIGO
         B         ENDOFPGM
*        +-----------------------------------------+----------+
*>>>>>>>>|   FINAL EL PROGRAMA                     | ENDOFPGM |<<<<<<<<
*        +-----------------------------------------+----------+
ENDOFPGM DS        0H
         LA        R15,0               <> CLEAR R15
         ICM       R15,B'0011',$CODIGO <> CODIGO DE RETORNO
*        RETORNO
         L         R13,4(R13)          <> SAVE ANTERIOR
         L         R14,12(R13)         <> R14 ANTERIOR
         LM        R0,R12,20(R13)      <> RESTO REGISTROS
         BSM       R0,R14
*
RTJG00   DS        0H
*        +-----------------------------------------+----------+
*>>>>>>>>|   CONVERSION JULIANA A GREGORIANA       | RTJG     |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R10                                    |
*        +   RECIBE:   @WJULIA                                |
*        +   RETORNA:  @WGREGO                                |
*        +----------------------------------------------------+
         MVC       @WGREGO(4),@WJULIA       <> TRANSFERIR EL ANO
*
         CLI       @WBISI,X'EE'        <> YA SE CALCULO EL BISIESTO?
         BNE       *+4+6+4              <> SI SALTAMOS
         PACK      @WBAAAA(3),@WJULIA(5)    <> ANO EN BIN
         BAS       R8,RTBI00           <> CALCULAR BISIESTO
*
         PACK      @WORKD,@WJULIA+4(3)      <> EMPAQUETAR EL DIA
         LA        R5,@TBMES                <> TABLA MESES ACTUALIZADA
         L         R1,=F'11'                <> ONCE MESES
         MH        R1,TBMESLGE              <> POR LONG. ELEMENTO
         AR        R5,R1                    <> DIRECC. DICIEMBRE
         ZAP       @WORKF,=P'12'            <> ANOTAR DICIEMBRE
RTJG20   CP        @WORKD,2(2,R5)           <> COMPARAR DIAS TRANSCU
         BH        RTJG30                   <> DETECTADO
         SH        R5,TBMESLGE              <> ELEMENTO ANTERIOR
         SP        @WORKF,=P'1'             <> MES ANTERIOR
         B         RTJG20
RTJG30   UNPK      @WGREGO+4(2),@WORKF      <> HALLADO MES
         OI        @WGREGO+5,X'F0'          <> SIGNO
         SP        @WORKD,2(2,R5)           <> RESTA DIAS TRANSCURR.
         UNPK      @WGREGO+6(2),@WORKD      <> ANOTAR LOS DIAS
         OI        @WGREGO+7,X'F0'          <> SIGNO
         CP        @WORKD,=P'0'             <> LOS DIAS FUERON 00
         BNE       RTJG99                   <> NO, DEVOLVER CONTROL
         UNPK      @WGREGO+6(2),0(2,R5)     <> ANOTAR DIAS TOTALES MES
         OI        @WGREGO+7,X'F0'          <> SIGNO
*
RTJG99   BR        R10                      <> DEVOLVER CONTROL
*
RTGJ00   DS        0H
*        +-----------------------------------------+----------+
*>>>>>>>>|    CONVERSION GREGORIANA A JULIANA      |    RTGJ  |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R10                                    |
*        +   RECIBE:   @WGREGO                                |
*        +   RETORNA:  @WJULIA                                |
*        +----------------------------------------------------+
         MVI       @WJULIA,C'0'
         MVC       @WJULIA+1(L'@WJULIA-1),@WJULIA
*
         MVC       @WJULIA(4),@WGREGO       <> TRANSFERIR EL ANO
*
         CLI       @WBISI,X'EE'        <> YA SE CALCULO EL BISIESTO?
         BNE       *+4+6+4             <> SI SALTAMOS
         PACK      @WBAAAA(3),@WGREGO(5)
         BAS       R8,RTBI00           <> CALCULAR BISIESTO
*
         PACK      @WORKD,@WGREGO+4(2)      <> EMPAQUETAR EL MES
         CVB       R15,@WORKD               <> PASAR A BINARIO
         BCTR      R15,R0                   <> RESTAR UNO
         MH        R15,TBMESLGE             <> CALC. DESPZ. EN TABLA
         LA        R5,@TBMES                <> TABLA DE MESES
         AR        R5,R15                   <> DIRECCIONAR MES
         PACK      @WORKD,@WGREGO+6(2)      <> EMPAQUETAR EL DIA
         AP        @WORKD,2(2,R5)           <> SUMAR DIAS ANTERIORES
         UNPK      @WJULIA+4(3),@WORKD+6(2) <> PASAR A PARAMETRO
         OI        @WJULIA+6,X'F0'          <> SIGNO DE ZONA
RTGJ99   BR        R10                      <> DEVOLVER CONTROL
*
RTJB00   DS        0H
*        +-----------------------------------------+----------+
*>>>>>>>>|    CONVERSION DE JULIANA A FECHA BASE   | RTJB     |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R10                                    |
*        +   RECIBE:   @WJULIA                                |
*        +   RETORNA:  @WBASE                                 |
*        +----------------------------------------------------+
*        +   FECHABASE = DIA + ((146097 * (ANO-1)) / 400)     |
*        +----------------------------------------------------+
         PACK  @WORKF,@WJULIA(4)        <> CAPTURAR EL ANO
         SP    @WORKF,=P'1'             <> RESTAR UNO
         ZAP   @WORKD,@WORKF
         MP    @WORKD,=P'365'           <> MULTIPL. POR CONSTANTE
         ZAP   @ACUMUL,@WORKD           <> ACUMULADOR
         ZAP   @WORKD,@WORKF
         DP    @WORKD,=P'4'             <> DIVISION POR 4
         AP    @ACUMUL,@WORKD(7)        <> ACUMULAR PARTE ENTERA
         ZAP   @WORKD,@WORKF
         DP    @WORKD,=P'400'           <> DIVISION POR 400
         AP    @ACUMUL,@WORKD(6)        <> ACUMULAR PARTE ENTERA
         ZAP   @WORKD,@WORKF
         DP    @WORKD,=P'100'           <> DIVISION POR 100
         SP    @ACUMUL,@WORKD(6)        <> RESTAR PARTE ENTERA
         PACK  @WORKF,@WJULIA+4(3)      <> CAPTURAR LOS DIAS
         AP    @ACUMUL,@WORKF           <> COCIENTE ANTER. + DIAS
         UNPK  @WBASE,@ACUMUL           <> PASAR A FECHA BASE
         OI    @WBASE+L'@WBASE-1,X'F0'  <> SIGNO
RTJB99   BR        R10                  <> DEVOLVER CONTROL
*
RTBJ00   DS        0H
*        +-----------------------------------------+----------+
*>>>>>>>>|    CONVERSION DE FECHA BASE A JULIANA   | RTBJ     |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R10                                    |
*        +   RECIBE:   @WBASE                                 |
*        +   RETORNA:  @WJULIA                                |
*        +----------------------------------------------------+
*        +   TECNICA UTILIZADA                                |
*        +   * DIVIDIR FEBASE POR 366 OBTENIENDO UN ANO QUE   |
*        +     SIEMPRE SERA MENOR QUE EL REAL                 |
*        +   * CALCULAR LA FEBASE PARA ESE ANO                |
*        +   * RESTAR DE FEBASE ORIGINAL LA CALCULADA         |
*        +   * SI EL RESTO ES SUPERIOR A 365 (O 366 SI EL ANO |
*        +     SIGUIENTE FUERA BISIESTO) AUMENTAR UNO AL ANO  |
*        +     Y RECALCULAR DE NUEVO.                         |
*        +   * CUANDO EL RESTO SEA MENOR A 365 (O 366) EL     |
*        +     ANO SERA EL SIGUIENTE AL QUE HEMOS UTILIZADO   |
*        +     EN LA ULTIMA BASE Y LOS DIAS EL RESTO.         |
*        +----------------------------------------------------+
         PACK      @WORKD,@WBASE            <> CAPTURAR FEBASE
         DP        @WORKD,=P'366'           <> OBTENER ANO BASE CALCULO
         ZAP       @WORKANO,@WORKD(6)
*
RTBJ10   DS        0H
         ZAP       @WORKD,@WORKANO
         MP        @WORKD,=P'365'           <> MULTIPL. POR CONSTANTE
         ZAP       @ACUMUL,@WORKD           <> ACUMULADOR
         ZAP       @WORKD,@WORKANO
         DP        @WORKD,=P'4'             <> DIVISION POR 4
         AP        @ACUMUL,@WORKD(7)        <> ACUMULAR PARTE ENTERA
         ZAP       @WORKD,@WORKANO
         DP        @WORKD,=P'400'           <> DIVISION POR 400
         AP        @ACUMUL,@WORKD(6)        <> ACUMULAR PARTE ENTERA
         ZAP       @WORKD,@WORKANO
         DP        @WORKD,=P'100'           <> DIVISION POR 100
         SP        @ACUMUL,@WORKD(6)        <> RESTAR PARTE ENTERA
         PACK      @WORKD,@WBASE
         SP        @WORKD,@ACUMUL
         ZAP       @WORKF,@WORKANO
         AP        @WORKF,=P'1'
         MVO       @WBAAAA(3),@WORKF+1(3)
         BAS       R8,RTBI00           <> CALCULO DE BISIESTO
         CP        @WORKD,@DIASANO          <> DIAS ANO SIGUIENTE
         BNH       RTBJ20                   <> ANO DETECTADO
         AP        @WORKANO,=P'1'           <> CALCULO ANO SIGUIENTE
         B         RTBJ10                   <> REPETIMOS BUCLE
*
RTBJ20   DS        0H
         AP        @WORKANO,=P'1'           <> ANO SIGUIENTE
         UNPK      @WJULIA(4),@WORKANO
         OI        @WJULIA+3,X'F0'          <> SIGNO
         UNPK      @WJULIA+4(3),@WORKD      <> DIAS DE DIREFERENCIA
         OI        @WJULIA+6,X'F0'          <> SIGNO
         CP        @WORKD,=P'0'                DIFERENCIA CERO ?
         BNE       RTBJ99
         UNPK      @WJULIA+4(3),@DIASANO
         OI        @WJULIA+6,X'F0'
*
RTBJ99   BR        R10                      <> DEVOLVER CONTROL
*
RTAG00   DS        0H
*        +-----------------------------------------+----------+
*>>>>>>>>|    CONVERSION ASTRONOMICA A GREGORIANA  | RTAG     |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R10                                    |
*        +   RECIBE:   @WASTRO                                |
*        +   RETORNA:  @WGREGO                                |
*        +-----------------------------------------+----------+
*
         PACK      @WORKDA,@WASTRO(7)  <> FECHA DE PARTIDA
*
* ATENCION LIMITES ORIGINALES ENTRE 2305814 O 2962884
*
         MP        @WORKDA,=P'4'       <> MULTIPLICAR POR 4
         SP        @WORKDA,=P'6884477' <> RESTAR 6,884,477
*
         ZAP       @WORKDY,@WORKDA     <> TOMAR RESULTADO
         DP        @WORKDY,=P'146097'  <> DIVIDIR POR 146,097
         ZAP       @WORKDD,@WORKDY+4(4) > GUARDAR RESTO
         ZAP       @WORKDY,@WORKDY(4)  <> DESPLAZAR EL COCIENTE
         MP        @WORKDY,=P'100'     <> MULTIPLICAR POR 100
*
         DP        @WORKDD,=P'4'       <> DIVIDIR POR 4
         ZAP       @WORKDD,@WORKDD(7)  <> DESPLAZAR COCIENTE
*
         ZAP       @WORKDA,@WORKDD     <> TOMAR RESULTADO
         MP        @WORKDA,=P'4'       <> MULTIPLICAR POR CUATRO
         AP        @WORKDA,=P'3'       <> SUMAR 3
*
         ZAP       @WORKDX,@WORKDA
         DP        @WORKDX,=P'1461'
         ZAP       @WORKDD,@WORKDX+5(3)
         ZAP       @WORKDX,@WORKDX(5)
         AP        @WORKDY,@WORKDX
*
         DP        @WORKDD,=P'4'
         ZAP       @WORKDD,@WORKDD(7)
         AP        @WORKDD,=P'1'
*
         ZAP       @WORKDA,@WORKDD
         MP        @WORKDA,=P'5'
         SP        @WORKDA,=P'3'
*
         ZAP       @WORKDM,@WORKDA
         DP        @WORKDM,=P'153'
         ZAP       @WORKDD,@WORKDM+6(2)
         ZAP       @WORKDM,@WORKDM(6)
         AP        @WORKDM,=P'1'
*
         DP        @WORKDD,=P'5'
         ZAP       @WORKDD,@WORKDD(7)
         AP        @WORKDD,=P'1'
*
         ZAP       @WGMES,@WORKDM      <> TRUNCAR EL MES
         CP        @WGMES,=P'11'       <> MES MENOR QUE 11 ?    ?
         BL        RTAG10              <> SI, SALTAMOS
         SP        @WGMES,=P'10'           SUBTRACT 10
         B         RTAG20                  CONTINUE
RTAG10   DS        0H
         AP        @WGMES,=P'2'        <> SUMAR 2 AL MES
RTAG20   DS        0H
         ZAP       @WGDIA,@WORKDD      <> TRUNCAR EL DIA
         DP        @WORKDM,=P'11'      <> DIVIDIR POR 11
         ZAP       @WGANO,@WORKDM(6)   <> COCIENTE
         AP        @WGANO,@WORKDY      <> ANO FINAL
*
         UNPK      @WGREGO+4(2),@WGMES        UNPACK MONTH
         OI        @WGREGO+5,X'F0'       CLEAR SIGN
         UNPK      @WGREGO+6(2),@WGDIA     UNPACK DAY
         OI        @WGREGO+7,X'F0'    CLEAR SIGN
         UNPK      @WGREGO(4),@WGANO       UNPACK YEAR
         OI        @WGREGO+3,X'F0'      CLEAR SIGN
*
RTAG99   BR        R10
*
RTGA00   DS        0H
*        +-----------------------------------------+----------+
*>>>>>>>>|    CONVERSION DE GREGORIANA A ATRONOMICA| RTGA     |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R10                                    |
*        +   RECIBE:   @WGREGO                                |
*        +   RETORNA:  @WASTRO                                |
*        +----------------------------------------------------+
         PACK      @WGANO,@WGREGO(4)   <> ANO DE GREGORIA PACKED
         PACK      @WGMES,@WGREGO+4(2) <> MES DE GREGORIANA PACKED
         PACK      @WGDIA,@WGREGO+6(2) <> DIA DE GREGORIANA PACKED
         CP        @WGMES(2),=P'2'     <> MES SUPERIOR A 2?
         BH        RTGA10              <> SI, SALTAMOS
*
         AP        @WGMES(2),=P'9'     <> SUMAR 9 AL MES
         SP        @WGANO(4),=P'1'     <> RES@WORKDAR UNO AL ANO
         B         RTGA20              <> CONITNUAR CONVERSION
*
RTGA10   DS        0H
         SP        @WGMES(2),=P'3'     <> RES@WORKDAR 3 AL MES
*
RTGA20   DP        @WGANO,=P'100'      <> DIVIDIR POR 100
         ZAP       @WORKDA,@WGANO(2)   <> SALVAR COCIENTE EN @WORKDA
         ZAP       @WORKDB,@WGANO+2(2) <> SALVAR RESTO EN @WORKDB
         MP        @WORKDA,=P'146097'  <> MULTIPLICAR POR 146097
         DP        @WORKDA,=P'4'       <> DIVIDIR POR 4
         ZAP       @WORKDA,@WORKDA(7)  <> DESPLAZAR COCIENTE S/RESTO
*                                      <>
         MP        @WORKDB,=P'1461'    <> MULTIPLICAR POR 1461
         DP        @WORKDB,=P'4'       <> DIVIDIR POR 4
         ZAP       @WORKDB,@WORKDB(7)  <> DESPLAZAR COCIENTE SOBR RESTO
*                                      <>
         ZAP       @WORKDC,@WGMES      <>
         MP        @WORKDC,=P'153'     <> MULTIPLICAR POR 153
         AP        @WORKDC,=P'2'       <> SUMAR 2
         DP        @WORKDC,=P'5'       <> DIVIDIR POR CINCO
         ZAP       @WORKDC,@WORKDC(7)  <> DESPLAZAR COCIENTE S/ RESTO
         AP        @WORKDC,@WGDIA      <> SUMAR EL DIA
         AP        @WORKDC,=P'1721119' <> SUMAR 1721119
*                                      <>
         ZAP       @WORKDX,@WORKDA     <> COMBINAR LAS RESPUESTAS
         AP        @WORKDX,@WORKDB     <>
         AP        @WORKDX,@WORKDC     <>
*                                      <>
         UNPK      @WASTRO(7),@WORKDX+4(4) <> UNPACK ANUM
         OI        @WASTRO+6,X'F0'     <> CLEAR SIGN
*                                      <>
RTGA99   BR        R10
*
*
RTVG00   DS        0H
*        +-----------------------------------------+----------+
*>>>>>>>>| VERIFICACION DE FECHA GREGORIANA        | RTGREOK  |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R10                                    |
*        +   RECIBE:   AREA @WGREGO                           |
*        +   RETORNA:  SI CORRECTA: POR R10                   |
*        +             SI INCORRECTA: -2 Y FIN DE EJECUCION   |
*        +----------------------------------------------------+
         MVC       @WORK15(L'@WGREGO),@WGREGO
         TR        @WORK15(L'@WGREGO),TBTRNUM
         CLC       @WORK15(L'@WGREGO),@WGREGO
         BNE       PERR02
         CLC       @WGREGO+4(2),=C'01'
         BL        PERR02
         CLC       @WGREGO+4(2),=C'12'
         BH        PERR02
*
         CLI       @WBISI,X'EE'        <> YA SE CALCULO EL BISIESTO?
         BNE       *+4+6+4             <> SI SALTAMOS
         PACK      @WBAAAA(3),@WGREGO(5)
         BAS       R8,RTBI00           <> CALCULAR BISIESTO
*
         PACK      @WORKD,@WGREGO+4(2) <> PACK EL MES
         CVB       R1,@WORKD
         BCTR      R1,R0               <> MES MENOS UNO
         MH        R1,TBMESLGE
         LA        R15,@TBMES
         AR        R15,R1              <> DIAS DEL MES
         PACK      @WORKF,@WGREGO+6(2)
         CP        @WORKF,=P'1'
         BL        PERR02
         CP        @WORKF,0(2,R15)     <> DIAS MAXIMOS DEL MES
         BH        PERR02              <> ERROR Y DEVOLUCION
*
RTVG99   BR        R10                 <> DEVOLUCION DE CONTROL
*
RTVJ00   DS        0H
*        +-----------------------------------------+----------+
*>>>>>>>>| VERIFICACION DE FECHA JULIANA           | RTVJ     |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R10                                    |
*        +   RECIBE:   AREA @WJULIA                           |
*        +   RETORNA:  SI CORRECTA: POR R10                   |
*        +             SI INCORRECTA: CR. -2 Y FIN MODULO     |
*        +----------------------------------------------------+
         MVC       @WORK15(L'@WJULIA),@WJULIA
         TR        @WORK15(L'@WJULIA),TBTRNUM
         CLC       @WORK15(L'@WJULIA),@WJULIA
         BNE       PERR02
*
         CLI       @WBISI,X'EE'        <> YA SE CALCULO EL BISIESTO?
         BNE       *+4+6+4             <> SI SALTAMOS
         PACK      @WBAAAA(3),@WJULIA(5)
         BAS       R8,RTBI00           <> CALCULAR BISIESTO
*
         PACK      @WORKF,@WJULIA+4(3) <> OBTENER DIAS
         CP        @WORKF,=P'1'
         BL        PERR02
         CP        @WORKF,@DIASANO     <> COMPARAR DIAS MAXIMOS
         BH        PERR02
*
RTVJ99   BR        R10
*
RTFA00   DS        0H
*        +-----------------------------------------+----------+
*>>>>>>>>| OBTENCION DE LA FECHA/HORA ACTUAL       | RTBI     |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R10                                    |
*        +   RECIBE:   NADA                                   |
*        +   RETORNA:  VALORES ACTUALIZADOS @??ACT            |
*        +----------------------------------------------------+
         MVC       @TIME(TIMEL),TIME
         TIME      DEC,@TIMEDAT,LINKAGE=SYSTEM,MF=(E,@TIME),           X
               DATETYPE=YYYYMMDD
*
         UNPK      @WHACT(9),@TIMEDAT(5)         <> HORA ACTUAL
         UNPK      @WFACT(9),@TIMEDAT+8(5)       <> FECHA ACTUAL GREGO
         MVC       @CENTURY,@WFACT               <> CENTURIA ACTUAL
RTFA99   BR        R10                 <> DEVOLUCION DE CONTROL
*
RTBI00   DS        0H
*        +-----------------------------------------+----------+
*>>>>>>>>| DETECCION DE ANO BISIESTO               | RTBI     |<<<<<<<<
*        +-----------------------------------------+----------+
*        +   ENLACE:   R8                                     |
*        +   RECIBE:   AREA @WBAAAA RELLENA                   |
*        +   RETORNA:  VALORES ACTUALIZADOS DEL ANO EN @TBMES |
*        +             DIAS DEL ANO EN @DIASANO               |
*        +             INDICADOR DE SI/NO EN @WBISI           |
*        +----------------------------------------------------+
         MVI       @WBISI,C'N'              <> INICIAR COMO NO BISIESTO
         ZAP       @DIASANO,=P'365'         <> POR DEFECTO 365 DIAS
         MVC       @TBMES(TBMESESL),TBMESES <> COPIA TABLA VALOR MESES
         TM        @WBAAAA+1,X'01'          <> ES ANO IMPAR
         BO        RTBI99                   <> SI, NO ES BISIESTO
         TM        @WBAAAA+1,X'12'          <> ES DIVISIBLE POR CUATRO
         BM        RTBI99                   <> NO, NO ES BISIESTO
         CLI       @WBAAAA+1,X'00'          <> ACABADO EN '00'
         BNE       RTBI10                   <> NO, ANO BISIESTO
         TM        @WBAAAA,X'01'            <> CENTENA IMPAR ?
         BO        RTBI99                   <> SI, NO ES BISIESTO
         TM        @WBAAAA,X'12'            <> DIVISIBLE POR CUATROCI.
         BM        RTBI99                   <> NO, DEVOLVER CONTROL
*
RTBI10   DS        0H
         MVI       @WBISI,C'S'              <> INDICAR BISIESTO
         ZAP       @DIASANO,=P'366'         <> ES BISIESTO, 366 DIAS
         LA        R15,@TBMES               <> DIRECCIONAR
         AH        R15,TBMESLGE             <> AL MES DE FEBRERO
         MVC       0(2,R15),=PL2'29'        <> ACTUALIZAR FEBRERO
         AH        R15,TBMESLGE             <> DIRECC. DIAS MARZO
         LA        R1,0
         LA        R1,10                    <> 10 MESES A TRATAR
RTBI20   DS        0H
         AP        2(2,R15),=P'1'           <> SUMAR UNO
         AH        R15,TBMESLGE             <> AVANZAR LA TABLA
         BCT       R1,RTBI20                <> REPETIR BUCLE
*
RTBI99   BR        R8                       <> DEVOLVER CONTROL
*
RTDS00   DS        0H
*        +-----------------------------------------+----------+
*>>>>>>>>| OBTENCION DEL DIA DE LA SEMANA          | RTDS     |<<<<<<<<
*        +-----------------------------------------+----------+
*        |   ENLACE:   R10                                    |
*        |   RECIBE:   @WBASE                                 |
*        |   RETORNA:  @DIASEMN                               |
*        +----------------------------------------------------+
         PACK      @WORKD,@WBASE            <> CAPTURAR FECHA BASE
         DP        @WORKD,=P'7'             <> DIVIDIR POR SIETE
         UNPK      @WDIASEN,@WORKD+7(1)
         OI        @WDIASEN,X'F0'           <> DIA SEMANA NUMERICO
RTDS99   BR        R10
*
RTLO00   DS        0H
*        +-----------------------------------------+----------+
*>>>>>>>>| OBTENCION FECHA-HORA GMT Y OFFSET LOCAL | RTLO     |<<<<<<<<
*        +-----------------------------------------+----------+
*        |   ENLACE:   R10                                    |
*        |   RECIBE:   NADA                                   |
*        |   RETORNA:  @WLOFFSE                               |
*        |             @FMTSTAM                               |
*        |             @TIMEGMT                               |
*        +----------------------------------------------------+
         MVC       @TIME(TIMEL),TIME
         TIME      DEC,@TIMEGMT,LINKAGE=SYSTEM,MF=(E,@TIME),           X
               DATETYPE=YYYYMMDD,ZONE=GMT
*
         UNPK      @GMTSTAM(9),@TIMEGMT+8(5)     <> FECHA GMT AAAAMMDD
         UNPK      @WORK15(13),@TIMEGMT(7)
         MVC       @GMTSTAM+8(12),@WORK15
*
         MVI       @WLOFFSE,C'E'
         MVI       @WLOFFSE+1,C'0'
         MVC       @WLOFFSE+1(L'@WLOFFSE-1),CEROS
*
         L         R4,CVTPTR           <> CVT ADDRESS
         USING     CVT,R4
         L         R4,CVTEXT2          <> CVT EXTENSION-2
         USING     CVTXTNT2,R4
*
         MVI       @WLOFFSE,C'W'       <> ESTABLECEMOS ZONA WEST
*
         ICM       R7,B'1111',CVTLDTOL <>  DIFF. LOCAL AND GMT
         JZ        RTLO10              <>  IS IT ZERO ?
         JM        *+4+4               <>  NEGATIVE DIFFERENCE
         MVI       @WLOFFSE,C'E'       <>  POSITIVE EAST
         LG        R1,CVTLDTO          <>  PASS TOD CLOCK VALUE
         LPGR      R1,R1               <>  NO SIGN
         STG       R1,@WORKD
*
         MVC       @STCKC(MSTCKCL),MSTCKC
         STCKCONV STCKVAL=@WORKD,CONVVAL=@TIMEOFF,                     X
               TIMETYPE=DEC,DATETYPE=YYYYMMDD,MF=(E,@STCKC)
*
         UNPK      @WORK15(13),@TIMEOFF(7)
         MVC       @WLOFFSE+1(6),@WORK15
RTLO10   DS        0H
         DROP      R4
*
RTLO99   BR        R10
*
RTFR00   DS        0H
*        +-----------------------------------------+----------+
*>>>>>>>>|  OBTENCION FECHAS RELIGIOSAS            | RTFR     |<<<<<<<<
*        +-----------------------------------------+----------+
*        |   ENLACE:   R9                                     |
*        |   RECIBE:   @WANO                                  |
*        |   RETORNA:  FECHAS EN AREAS DEL PARAMETRO          |
*        +----------------------------------------------------+
*        |                                                    |
*        |   ANOS VALIDOS ENTRE 1601 Y 3399 INCLUSIVE         |
*        |                                                    |
*        |   BASADA EN UNA CODFICACION DE JAY MOSELEY         |
*        |                                                    |
*        +----------------------------------------------------+
*
*        PASO 1: COMPUTE CENTURY NUMBER + 1.
*
         PACK      @CENTPAK,@WANO(2)
         AP        @CENTPAK,=P'1'
*
*        PASO 2: COMPUTE NON-LEAP-YEAR CENTESIMALS.
*
         PACK      @WKP5,@WANO         <> AMPLIAR ANO
         SP        @WKP5,=P'1600'      <> RESTAR 1600
         DP        @WKP5,=P'400'       <> DIVIDIR POR 400
         ZAP       @WKT2,@WKP5+1(2)    <> TOMAR EL COCIENTE
         MP        @WKT2,=P'3'         <> MULTIPLICARLO POR TRES
         ZAP       @WKP5,@WKP5+3(2)    <> COGER EL RESTO
         DP        @WKP5,=P'100'       <> DIVIDIR POR 100
         ZAP       @WKT3,@WKP5+2(1)    <> GUARDAR EL COCIENTE
         ZAP       @WKNONL,@WKT2       <> COMBINAR LOS
         AP        @WKNONL,@WKT3       <>              DOS VALORES
*
*        PASO 3: COMPUTE YEAR'S POSITION IN METONIC CYCLE.
*
         PACK      @WKP5,@WANO         <> EXPANDIR EL ANO
         DP        @WKP5,=P'19'        <> DIVIDIR POR 19
         AP        @WKP5+3(2),=P'1'    <> SUMAR UNO AL RESTO
         ZAP       @WKMET,@WKP5+3(2)   <> GUARDAR RESPUESTA
*
*        PASO 4: COMPUTE CORRECTION FOR METONIC CYCLE.
*
         ZAP       @WKP5,@CENTPAK      <> EXPANDIR CENTURIA
         MP        @WKP5,=P'8'         <> MULTIPLICAR POR 8
         AP        @WKP5,=P'5'         <> SUMAR 5
         DP        @WKP5,=P'25'        <> DIVIDIR POR 25
         SP        @WKP5(3),=P'5'      <> RESTAR 5
         SP        @WKP5(3),@WKNONL    <> RESTAR VALOR GUARDADO
         ZAP       @WKMETC,@WKP5+1(2)  <> GUARDAR RESOUESTA
*
*
*        PASO 5: COMPUTE DAY COUNT MODIFIER.
*
         PACK      @WKP5,@WANO         <> EXPANDIR EL ANO
         MP        @WKP5,=P'5'         <> MULTIPLICAR POR CINCO
         DP        @WKP5,=P'4'         <> DIVIDIR POR CUATRO
         SP        @WKP5(4),@WKNONL    <> RESTAR VALOR ANTERIOR
         SP        @WKP5(4),=P'10'     <> RESTAR 10
         ZAP       @WKDMOD,@WKP5+1(3)  <> GUARDAR RESPUESTA
*
*        PASO 6: COMPUTE THE EPACT.
*
         ZAP       @WKP5,@WKMET        <> TOMAR METONIC
         MP        @WKP5,=P'11'        <> MULTIPLICAR POR ONCE
         AP        @WKP5,=P'20'        <> SUMAR 20
         AP        @WKP5,@WKMETC       <> SUMAR CORRECION METONICA
         DP        @WKP5,=P'30'        <> DIVIDIR POR 30
         ZAP       @WKEPACT,@WKP5+3(2) <> GUARDAR RESPUESTA
*
*        PASO 7: DETERMINE THE EPACT VALUE.
*
         CP        @WKEPACT,=P'25'     <> ES EPACT 25?
         BNE       RTFREADJ            <> NO
*
*        PASO 8: DETERMINE METONIC CYCLE POSITION FOR EPACT ADJUST.
*
         CP        @WKMET,=P'11'       <> ES CICLO METONICO 11?
         BNH       RTFREADJ            <> NO
         AP        @WKEPACT,=P'1'      <> SUMAR 1 A EPACT
*
*        PASO 9: DETERMINE THE EPACT VALUE FOR ADJUSTMENT.
*
RTFREADJ CP        @WKEPACT,=P'24'     <> ES EPACT 24?
         BNE       RTFRDAYV            <> NO
         AP        @WKEPACT,=P'1'      <> SUMAR UNO A EPACT
*
*        PASO 10: COMPUTE VALUE OF DAY.
*
RTFRDAYV ZAP       @WKDAY,=P'44'       <> INIT DIA COMO 44
         SP        @WKDAY,@WKEPACT     <> RESTAR EPACT
*
*        PASO 11: DETERMINE DAY VALUE FOR ADJUSTMENT.
*
         CP        @WKDAY,=P'21'       <> ES EL DIA 21 O MAYOR?
         BNL       RTFRCAND            <> SI
         AP        @WKDAY,=P'30'       <> SUMAR 30 DIAS
*        -----------------------------------------
*        PASO 12: FIND MODIFIED DAY VALUE.
*        -----------------------------------------
RTFRCAND ZAP       @WKP4,@WKDAY        <> EXPANDIR EL DIA
         AP        @WKP4,=P'7'         <> SUMAR 7
         ZAP       @WKP5,@WKDAY        <> EXPANDIR EL DIA
         AP        @WKP5,@WKDMOD       <> ANADIR DMOD
         DP        @WKP5,=P'7'         <> DIVIDIR POR SIETE
         SP        @WKP4,@WKP5+4(1)    <> RESTAR RESTO ANTERIOR
         ZAP       @WKDAY,@WKP4+2(2)   <> SALVAR RESPUESTA
*        -----------------------------------------
*        PASO 13: FIND EXACT DATE:
*                  IF DAY LESS THAN/EQUAL 31
*                   THEN EASTER IS 03/DAY/YR
*                   ELSE EASTER IS 04/(DAY - 31)/YR.
*        -----------------------------------------
         MVC       @WEASTER(2),=C'03'  <> PREASUMIR ES MARZO
         CP        @WKDAY,=P'31'       <> DIA MAYOR QUE 31?
         BNH       RTFR10              <> NO
         MVC       @WEASTER(2),=C'04'  <> ENTONCES MES=ABRIL
         SP        @WKDAY,=P'31'       <> AJUSTAR EL DIA
RTFR10   UNPK      @WKZ3,@WKDAY        <> DESEMPAQUETAR EL DIA
         OI        @WKZ3+2,X'F0'       <> LIMPIEZA DE SIGNO
         MVC       @WEASTER+2(2),@WKZ3+1
         MVC       @WEASTER+4(4),@WANO
*
         MVC       $RESURRE+0(4),@WEASTER+4      <> RESURRECCION
         MVC       $RESURRE+4(2),@WEASTER+0
         MVC       $RESURRE+6(2),@WEASTER+2
*
         MVC       @WGREGO,$RESURRE
         BAS       R10,RTGJ00
         BAS       R10,RTJB00          <> FECHA BASE RESURRECCION
         PACK      @WBASRES,@WBASE     <> GUARDAR FECHA REFERENCIA
*
         ZAP       @WKP5,@WBASRES      <> FECHA DE REFERENCIA
         SP        @WKP5,=P'46'        <> MIERCOLES DE CENIZA
         UNPK      @WBASE(7),@WKP5
         OI        @WBASE+L'@WBASE-1,X'F0'
         BAS       R10,RTBJ00          <> CONVERTIR A JULIANA
         BAS       R10,RTJG00          <> CONVERTIR A GREGORIANA
         MVC       $MICENIZ,@WGREGO
*
         ZAP       @WKP5,@WBASRES      <> FECHA DE REFERENCIA
         SP        @WKP5,=P'2'         <> VIERNES SANTO
         UNPK      @WBASE(7),@WKP5
         OI        @WBASE+L'@WBASE-1,X'F0'
         BAS       R10,RTBJ00          <> CONVERTIR A JULIANA
         BAS       R10,RTJG00          <> CONVERTIR A GREGORIANA
         MVC       $VIERNST,@WGREGO
*
         ZAP       @WKP5,@WBASRES      <> FECHA DE REFERENCIA
         AP        @WKP5,=P'39'        <> ASCENSION
         UNPK      @WBASE(7),@WKP5
         OI        @WBASE+L'@WBASE-1,X'F0'
         BAS       R10,RTBJ00          <> CONVERTIR A JULIANA
         BAS       R10,RTJG00          <> CONVERTIR A GREGORIANA
         MVC       $ASCENSI,@WGREGO
*
         ZAP       @WKP5,@WBASRES      <> FECHA DE REFERENCIA
         AP        @WKP5,=P'49'        <> PENTECOSTES
         UNPK      @WBASE(7),@WKP5
         OI        @WBASE+L'@WBASE-1,X'F0'
         BAS       R10,RTBJ00          <> CONVERTIR A JULIANA
         BAS       R10,RTJG00          <> CONVERTIR A GREGORIANA
         MVC       $PENTECO,@WGREGO
*
         ZAP       @WKP5,@WBASRES      <> FECHA DE REFERENCIA
         AP        @WKP5,=P'60'        <> CORPUS CHRISTI
         UNPK      @WBASE(7),@WKP5
         OI        @WBASE+L'@WBASE-1,X'F0'
         BAS       R10,RTBJ00          <> CONVERTIR A JULIANA
         BAS       R10,RTJG00          <> CONVERTIR A GREGORIANA
         MVC       $CORPUSC,@WGREGO
*
RTFR99   BR        R9                       <> DEVOLVER CONTROL
*        +--------------------------------+
*>>>>>>>>| RESERVA DE AREAS ESTATICAS     |
*        +--------------------------------+
* ---------    VARIABLE CUSTOMIZABLE PARA CADA INSTALACION -----------
*
SETLOCAL DC    CL7'E010000'            <> VER COMENTARIO PRINCIPIO PGM
*
* ---------    VARIABLE CUSTOMIZABLE PARA CADA INSTALACION -----------
         DS    0F
KH0      DC    H'0'
KH4      DC    H'4'
KP0      DC    PL1'0'
KP1      DC    PL1'1'
KP60     DC    P'60'
KP3600   DC    P'3600'
KPMHZ    DC    P'1048576'
KMNPARM  DC    H'12' <> MAX. NUM, PARAM.
KVERFEC1 DC    CL4'0331'
KVERHOR1 DC    CL4'0200'
KVERFEC2 DC    CL4'1031'
KVERHOR2 DC    CL4'0300'
KVERCAMB DC    CL4'0200'               <> HORA COMIENZO HOR.INVIERNO
*
BLANCOS  DC    CL40' '
CEROS    DC    CL8'00000000'
*
TIME     TIME  LINKAGE=SYSTEM,MF=L
TIMEL    EQU       *-TIME
*
MSTCKC   STCKCONV  MF=L
MSTCKCL  EQU       *-MSTCKC
*
MCONVT   CONVTOD   MF=L
MCONVTL  EQU       *-MCONVT
*
TBTRNUM  DC    X'00000000000000000000000000000000' 0
         DC    X'00000000000000000000000000000000' 1
         DC    X'00000000000000000000000000000000' 2
         DC    X'00000000000000000000000000000000' 3
         DC    X'00000000000000000000000000000000' 4
         DC    X'00000000000000000000000000000000' 5
         DC    X'00000000000000000000000000000000' 6
         DC    X'00000000000000000000000000000000' 7
         DC    X'00000000000000000000000000000000' 8
         DC    X'00000000000000000000000000000000' 9
         DC    X'00000000000000000000000000000000' A
         DC    X'00000000000000000000000000000000' B
         DC    X'00000000000000000000000000000000' C
         DC    X'00000000000000000000000000000000' D
         DC    X'00000000000000000000000000000000' E
         DC    X'F0F1F2F3F4F5F6F7F8F9000000000000' F
*
TBMESLGE DC        H'4'                <> LONG. CADA ELEMENTO TABLA
TBMESES  EQU       *
         DC        PL2'31',PL2'000'    <> ENE
         DC        PL2'28',PL2'031'    <> FEB
         DC        PL2'31',PL2'059'    <> MAR
         DC        PL2'30',PL2'090'    <> ABR
         DC        PL2'31',PL2'120'    <> MAY
         DC        PL2'30',PL2'151'    <> JUN
         DC        PL2'31',PL2'181'    <> JUL
         DC        PL2'31',PL2'212'    <> AGO
         DC        PL2'30',PL2'243'    <> SEP
         DC        PL2'31',PL2'273'    <> OCT
         DC        PL2'30',PL2'304'    <> NOV
         DC        PL2'31',PL2'334'    <> DIC
TBMESESL EQU       *-TBMESES
*
         LTORG
*
TBIDIOMA DS    0F
         DC    CL4'    ',A(TBI341)     <> SI NO EXPLICITO
         DC    CL4'341 ',A(TBI341)     <> CASTELLANO
         DC    CL4'343 ',A(TBI343)  ------CATALAN------- FALTA
         DC    CL4'346 ',A(TBI346)  ------VASCO--------- FALTA
         DC    CL4'3481',A(TBI3481) ------GALLEGO------- FALTA
         DC    CL4'33  ',A(TBI33)      <> FRANCES
         DC    CL4'351 ',A(TBI351)  ------PORTUGUES----- FALTA
         DC    CL4'39  ',A(TBI39)      <> ITALIANO
         DC    CL4'44  ',A(TBI44)      <> INGLES
         DC    CL4'49  ',A(TBI49)      <> ALEMAN
         DC    CL4'****',A(TBI341)     <> CASTELLANO ES EL DEFECTO
*
*  TBI341 -->  CASTELLANO
*
TBI341   DS    0F
         DC    A(TBI341D)
         DC    A(TBI341S)
         DC    A(TBI341C)
         DC    A(TBI341M)
TBI341D  DC    H'13'
         DC    CL13'UNO'
         DC    CL13'DOS'
         DC    CL13'TRES'
         DC    CL13'CUATRO'
         DC    CL13'CINCO'
         DC    CL13'SEIS'
         DC    CL13'SIETE'
         DC    CL13'OCHO'
         DC    CL13'NUEVE'
         DC    CL13'DIEZ'
         DC    CL13'ONCE'
         DC    CL13'DOCE'
         DC    CL13'TRECE'
         DC    CL13'CATORCE'
         DC    CL13'QUINCE'
         DC    CL13'DIECISEIS'
         DC    CL13'DIECISIETE'
         DC    CL13'DIECIOCHO'
         DC    CL13'DIECINUEVE'
         DC    CL13'VEINTE'
         DC    CL13'VEINTIUNO'
         DC    CL13'VEINTIDOS'
         DC    CL13'VEINTITRES'
         DC    CL13'VEINTICUATRO'
         DC    CL13'VEINTICINCO'
         DC    CL13'VEINTISEIS'
         DC    CL13'VEINTISIETE'
         DC    CL13'VEINTIOCHO'
         DC    CL13'VEINTINUEVE'
         DC    CL13'TREINTA'
         DC    CL13'TREINTA Y UNO'
TBI341S  DC    H'09'
         DC    CL09'DOMINGO'
         DC    CL09'LUNES'
         DC    CL09'MARTES'
         DC    CL09'MIERCOLES'
         DC    CL09'JUEVES'
         DC    CL09'VIERNES'
         DC    CL09'SABADO'
TBI341C  DC    H'03'
         DC    CL03'ENE'
         DC    CL03'FEB'
         DC    CL03'MAR'
         DC    CL03'ABR'
         DC    CL03'MAY'
         DC    CL03'JUN'
         DC    CL03'JUL'
         DC    CL03'AGO'
         DC    CL03'SEP'
         DC    CL03'OCT'
         DC    CL03'NOV'
         DC    CL03'DIC'
TBI341M  DC    H'10'
         DC    CL10'ENERO'
         DC    CL10'FEBRERO'
         DC    CL10'MARZO'
         DC    CL10'ABRIL'
         DC    CL10'MAYO'
         DC    CL10'JUNIO'
         DC    CL10'JULIO'
         DC    CL10'AGOSTO'
         DC    CL10'SEPTIEMBRE'
         DC    CL10'OCTUBRE'
         DC    CL10'NOVIEMBRE'
         DC    CL10'DICIEMBRE'
*
*  TBI343 -->  CATALAN
*
TBI343   DS    0F
         DC    A(TBI343D)
         DC    A(TBI343S)
         DC    A(TBI343C)
         DC    A(TBI343M)
TBI343D  DC    H'13'
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
         DC    CL13'...'            >> CATALAN <<
TBI343S  DC    H'09'                >> CATALAN <<
         DC    CL09'DIUMENGE'       >> CATALAN <<
         DC    CL09'DILLUNS'        >> CATALAN <<
         DC    CL09'DIMARTS'        >> CATALAN <<
         DC    CL09'DIMECRES'       >> CATALAN <<
         DC    CL09'DIJOUS'         >> CATALAN <<
         DC    CL09'DIVENDRES'      >> CATALAN <<
         DC    CL09'DISSABTE'       >> CATALAN <<
TBI343C  DC    H'03'                >> CATALAN <<
         DC    CL03'GEN'            >> CATALAN <<
         DC    CL03'FEB'            >> CATALAN <<
         DC    CL03'MAR'            >> CATALAN <<
         DC    CL03'ABR'            >> CATALAN <<
         DC    CL03'MAI'            >> CATALAN <<
         DC    CL03'JUN'            >> CATALAN <<
         DC    CL03'JUL'            >> CATALAN <<
         DC    CL03'AGO'            >> CATALAN <<
         DC    CL03'SET'            >> CATALAN <<
         DC    CL03'OCT'            >> CATALAN <<
         DC    CL03'NOV'            >> CATALAN <<
         DC    CL03'DES'            >> CATALAN <<
TBI343M  DC    H'08'                >> CATALAN <<
         DC    CL08'GENER'          >> CATALAN <<
         DC    CL08'FEBRER'         >> CATALAN <<
         DC    CL08'MAR'            >> CATALAN <<
         DC    CL08'ABRIL'          >> CATALAN <<
         DC    CL08'MAIG'           >> CATALAN <<
         DC    CL08'JUNY'           >> CATALAN <<
         DC    CL08'JULIOL'         >> CATALAN <<
         DC    CL08'AGOST'          >> CATALAN <<
         DC    CL08'SETEMBRE'       >> CATALAN <<
         DC    CL08'OCTUBRE'        >> CATALAN <<
         DC    CL08'NOVEMBRE'       >> CATALAN <<
         DC    CL08'DESEMBRE'       >> CATALAN <<
*
*  TBI346 -->  VASCO
*
TBI346   DS    0F
         DC    A(TBI346D)
         DC    A(TBI346S)
         DC    A(TBI346C)
         DC    A(TBI346M)
TBI346D  DC    H'17'
         DC    CL17'BAT'            >> VASCO <<
         DC    CL17'BI'             >> VASCO <<
         DC    CL17'HIRU'           >> VASCO <<
         DC    CL17'LAU'            >> VASCO <<
         DC    CL17'BOST'           >> VASCO <<
         DC    CL17'SEI'            >> VASCO <<
         DC    CL17'ZAZPI'          >> VASCO <<
         DC    CL17'ZORTZI'         >> VASCO <<
         DC    CL17'BEDERATZI'      >> VASCO <<
         DC    CL17'HAMAR'          >> VASCO <<
         DC    CL17'HAMAIKA'        >> VASCO <<
         DC    CL17'HAMABI'         >> VASCO <<
         DC    CL17'HAMAHIRU'       >> VASCO <<
         DC    CL17'HAMALAU'        >> VASCO <<
         DC    CL17'HAMABOST'       >> VASCO <<
         DC    CL17'HAMASEI'        >> VASCO <<
         DC    CL17'HAMAZAZPI'      >> VASCO <<
         DC    CL17'HEMEZORTZI'     >> VASCO <<
         DC    CL17'HEMERETZI'      >> VASCO <<
         DC    CL17'HOGEI'             >> VASCO <<
         DC    CL17'HOGEITA BAT'       >> VASCO <<
         DC    CL17'HOGEITA BI'        >> VASCO <<
         DC    CL17'HOGEITA HIRU'      >> VASCO <<
         DC    CL17'HOGEITA LAU'       >> VASCO <<
         DC    CL17'HOGEITA BOST'      >> VASCO <<
         DC    CL17'HOGEITA SEI'       >> VASCO <<
         DC    CL17'HOGEITA ZAZPI'     >> VASCO <<
         DC    CL17'HOGEITA ZORTZI'    >> VASCO <<
         DC    CL17'HOGEITA BEDERATZI' >> VASCO <<
         DC    CL17'HOGEITA HAMAR'     >> VASCO <<
         DC    CL17'HOGEITA HAMAIKA'   >> VASCO <<
TBI346S  DC    H'10'                >> VASCO <<
         DC    CL10'IGANDEA'        >> VASCO <<
         DC    CL10'ASTELEHENA'     >> VASCO <<
         DC    CL10'ASTEARTEA'      >> VASCO <<
         DC    CL10'ASTEAZKENA'     >> VASCO <<
         DC    CL10'OSTEGUNA'       >> VASCO <<
         DC    CL10'OSTIRALA'       >> VASCO <<
         DC    CL10'LARUNBATA'      >> VASCO <<
TBI346C  DC    H'03'                >> VASCO <<
         DC    CL03'URT'            >> VASCO <<
         DC    CL03'OTS'            >> VASCO <<
         DC    CL03'MAR'            >> VASCO <<
         DC    CL03'API'            >> VASCO <<
         DC    CL03'MAI'            >> VASCO <<
         DC    CL03'EKA'            >> VASCO <<
         DC    CL03'UZT'            >> VASCO <<
         DC    CL03'ABU'            >> VASCO <<
         DC    CL03'IRA'            >> VASCO <<
         DC    CL03'URR'            >> VASCO <<
         DC    CL03'AZA'            >> VASCO <<
         DC    CL03'ABE'            >> VASCO <<
TBI346M  DC    H'09'                >> VASCO <<
         DC    CL09'URTARRILA'      >> VASCO <<
         DC    CL09'OTSAILA'        >> VASCO <<
         DC    CL09'MARTXOA'        >> VASCO <<
         DC    CL09'APIRILA'        >> VASCO <<
         DC    CL09'MAIATZA'        >> VASCO <<
         DC    CL09'EKAINA'         >> VASCO <<
         DC    CL09'UZTAILA'        >> VASCO <<
         DC    CL09'ABUZTUA'        >> VASCO <<
         DC    CL09'IRAILA'         >> VASCO <<
         DC    CL09'URRIA'          >> VASCO <<
         DC    CL09'AZAROA'         >> VASCO <<
         DC    CL09'ABENDUA'        >> VASCO <<
*
*  TBI3481 --> GALLEGO
*
TBI3481  DS    0F
         DC    A(TBI3481D)
         DC    A(TBI3481S)
         DC    A(TBI3481C)
         DC    A(TBI3481M)
TBI3481D DC    H'19'
         DC    CL19'UN'             >> GALLEGO <<
         DC    CL19'DOUS'           >> GALLEGO <<
         DC    CL19'TRES'           >> GALLEGO <<
         DC    CL19'CATRO'          >> GALLEGO <<
         DC    CL19'CINCO'          >> GALLEGO <<
         DC    CL19'SEIS'           >> GALLEGO <<
         DC    CL19'SETE'           >> GALLEGO <<
         DC    CL19'OITO'           >> GALLEGO <<
         DC    CL19'NOVE'           >> GALLEGO <<
         DC    CL19'DEZ'            >> GALLEGO <<
         DC    CL19'ONCE'           >> GALLEGO <<
         DC    CL19'DOCE'           >> GALLEGO <<
         DC    CL19'TRECE'          >> GALLEGO <<
         DC    CL19'CATORCE'        >> GALLEGO <<
         DC    CL19'QUINCE'         >> GALLEGO <<
         DC    CL19'DEZASEIS'       >> GALLEGO <<
         DC    CL19'DEZASETE'       >> GALLEGO <<
         DC    CL19'DEZAOITO'       >> GALLEGO <<
         DC    CL19'DEZANOVE'       >> GALLEGO <<
         DC    CL19'VINTE'          >> GALLEGO <<
         DC    CL19'VINTE E UN'     >> GALLEGO <<
         DC    CL19'VINTE E DOUS'   >> GALLEGO <<
         DC    CL19'VINTE E TRES'   >> GALLEGO <<
         DC    CL19'VINTE E CATRO'  >> GALLEGO <<
         DC    CL19'VINTE E CINCO'  >> GALLEGO <<
         DC    CL19'VINTE E SEIS'   >> GALLEGO <<
         DC    CL19'VINTE E SETE'   >> GALLEGO <<
         DC    CL19'VINTE E OITO'   >> GALLEGO <<
         DC    CL19'VINTE E NOVE'   >> GALLEGO <<
         DC    CL19'TRINTA'         >> GALLEGO <<
         DC    CL19'TRINTA E UN'    >> GALLEGO <<
TBI3481S DC    H'08'                >> GALLEGO <<
         DC    CL08'DOMINGO'        >> GALLEGO <<
         DC    CL08'LUNS'           >> GALLEGO <<
         DC    CL08'MARTES'         >> GALLEGO <<
         DC    CL08'MERCORES'       >> GALLEGO <<
         DC    CL08'XOVES'          >> GALLEGO <<
         DC    CL08'VENRES'         >> GALLEGO <<
         DC    CL08'SABADO'         >> GALLEGO <<
TBI3481C DC    H'03'                >> GALLEGO <<
         DC    CL03'XAN'            >> GALLEGO <<
         DC    CL03'FEB'            >> GALLEGO <<
         DC    CL03'MAR'            >> GALLEGO <<
         DC    CL03'ABR'            >> GALLEGO <<
         DC    CL03'MAI'            >> GALLEGO <<
         DC    CL03'XUN'            >> GALLEGO <<
         DC    CL03'XUL'            >> GALLEGO <<
         DC    CL03'AGO'            >> GALLEGO <<
         DC    CL03'SET'            >> GALLEGO <<
         DC    CL03'OUT'            >> GALLEGO <<
         DC    CL03'NOV'            >> GALLEGO <<
         DC    CL03'DEC'            >> GALLEGO <<
TBI3481M DC    H'10'                >> GALLEGO <<
         DC    CL10'XANEIRO'        >> GALLEGO <<
         DC    CL10'FEBREIRO'       >> GALLEGO <<
         DC    CL10'MARZO'          >> GALLEGO <<
         DC    CL10'ABRIL'          >> GALLEGO <<
         DC    CL10'MAIO'           >> GALLEGO <<
         DC    CL10'XUNIO'          >> GALLEGO <<
         DC    CL10'XULLO'          >> GALLEGO <<
         DC    CL10'AGOSTO'         >> GALLEGO <<
         DC    CL10'SETEMBRO'       >> GALLEGO <<
         DC    CL10'OUTUBRO'        >> GALLEGO <<
         DC    CL10'NOVEMBRO'       >> GALLEGO <<
         DC    CL10'DECEMBRO'       >> GALLEGO <<
*
*  TBI44  ---> INGLES
*
TBI44    DS    0F                      <> INGLES
         DC    A(TBI44D)
         DC    A(TBI44S)
         DC    A(TBI44C)
         DC    A(TBI44M)
TBI44D   DC    H'12'
         DC    CL12'ONE'
         DC    CL12'TWO'
         DC    CL12'THREE'
         DC    CL12'FOUR'
         DC    CL12'FIVE'
         DC    CL12'SIX'
         DC    CL12'SEVEN'
         DC    CL12'EIGHT'
         DC    CL12'NINE'
         DC    CL12'TEN'
         DC    CL12'ELEVEN'
         DC    CL12'TWELVE'
         DC    CL12'THIRTEEN'
         DC    CL12'FORTEEN'
         DC    CL12'FIFTEEN'
         DC    CL12'SIXTEEN'
         DC    CL12'SEVENTEEN'
         DC    CL12'EIGHTEEN'
         DC    CL12'NINETEEN'
         DC    CL12'TWENTY'
         DC    CL12'TWENTY ONE'
         DC    CL12'TWENTY TWO'
         DC    CL12'TWENTY THREE'
         DC    CL12'TWENTY FOUR'
         DC    CL12'TWENTY FIVE'
         DC    CL12'TWENTY SIX'
         DC    CL12'TWENTY SEVEN'
         DC    CL12'TWENTY EIGHT'
         DC    CL12'TWENTY NINE'
         DC    CL12'THIRTY'
         DC    CL12'THIRTY ONE'
TBI44S   DC    H'09'
         DC    CL09'SUNDAY'
         DC    CL09'MONDAY'
         DC    CL09'TUESDAY'
         DC    CL09'WEDNESDAY'
         DC    CL09'THURSDAY'
         DC    CL09'FRIDAY'
         DC    CL09'SATURDAY'
TBI44C   DC    H'03'
         DC    CL03'JAN'
         DC    CL03'FEB'
         DC    CL03'MAR'
         DC    CL03'APR'
         DC    CL03'MAY'
         DC    CL03'JUN'
         DC    CL03'JUL'
         DC    CL03'AUG'
         DC    CL03'SEP'
         DC    CL03'OCT'
         DC    CL03'NOV'
         DC    CL03'DEC'
TBI44M   DC    H'09'
         DC    CL09'JANUARY'
         DC    CL09'FEBRUARY'
         DC    CL09'MARCH'
         DC    CL09'APRIL'
         DC    CL09'MAY'
         DC    CL09'JUNE'
         DC    CL09'JULY'
         DC    CL09'AUGUST'
         DC    CL09'SEPTEMBER'
         DC    CL09'OCTOBER'
         DC    CL09'NOVEMBER'
         DC    CL09'DECEMBER'
*
*  TBI33  ---> FRANCES
*
TBI33    DS    0F                      <> FRANCES
         DC    A(TBI33D)
         DC    A(TBI33S)
         DC    A(TBI33C)
         DC    A(TBI33M)
TBI33D   DC    H'12'
         DC    CL12'UN'
         DC    CL12'DEUX'
         DC    CL12'TROIS'
         DC    CL12'QUATRE'
         DC    CL12'CINQ'
         DC    CL12'SIX'
         DC    CL12'SEPT'
         DC    CL12'HUIT'
         DC    CL12'NEUF'
         DC    CL12'DIX'
         DC    CL12'ONZE'
         DC    CL12'DOUZE'
         DC    CL12'TREIZE'
         DC    CL12'QUATORZE'
         DC    CL12'QUINZE'
         DC    CL12'SEIZE'
         DC    CL12'DIX-SEPT'
         DC    CL12'DIX-HUIT'
         DC    CL12'DIX-NEUF'
         DC    CL12'VINGT'
         DC    CL12'VINGT UN'
         DC    CL12'VINGT DEUX'
         DC    CL12'VINGT TROIS'
         DC    CL12'VINGT QUATRE'
         DC    CL12'VINGT CINQ'
         DC    CL12'VINGT SIX'
         DC    CL12'VINGT SEPT'
         DC    CL12'VINGT HUIT'
         DC    CL12'VINGT NEUF'
         DC    CL12'TRENTE'
         DC    CL12'TRENTE UNE INT'
TBI33S   DC    H'08'
         DC    CL08'DIMANCHE'
         DC    CL08'LUNDI'
         DC    CL08'MARDI'
         DC    CL08'MERCREDI'
         DC    CL08'JEUDI'
         DC    CL08'VENDREDI'
         DC    CL08'SAMEDI'
TBI33C   DC    H'03'
         DC    CL03'JAN'
         DC    CL03'FEB'
         DC    CL03'MAR'
         DC    CL03'AVR'
         DC    CL03'MAI'
         DC    CL03'JUI'
         DC    CL03'JUL'
         DC    CL03'AOU'
         DC    CL03'SEP'
         DC    CL03'OCT'
         DC    CL03'NOV'
         DC    CL03'DEC'
TBI33M   DC    H'09'
         DC    CL09'JANVIER'
         DC    CL09'FEVRIER'
         DC    CL09'MARS'
         DC    CL09'AVRIL'
         DC    CL09'MAI'
         DC    CL09'JUIN'
         DC    CL09'JUILLET'
         DC    CL09'AOUT'
         DC    CL09'SEPTEMBRE'
         DC    CL09'OCTOBRE'
         DC    CL09'NOVEMBRE'
         DC    CL09'DECEMBRE'
*
*  TBI39  ---> ITALIANO
*
TBI39    DS    0F
         DC    A(TBI39D)
         DC    A(TBI39S)
         DC    A(TBI39C)
         DC    A(TBI39M)
TBI39D   DC    H'12'
         DC    CL12'UN'            << ITALIANO >>
         DC    CL12'DUE'           << ITALIANO >>
         DC    CL12'TRE'           << ITALIANO >>
         DC    CL12'QUATTRO'       << ITALIANO >>
         DC    CL12'CINQUE'        << ITALIANO >>
         DC    CL12'SEI'           << ITALIANO >>
         DC    CL12'SETTE'         << ITALIANO >>
         DC    CL12'OTTO'          << ITALIANO >>
         DC    CL12'NOVE'          << ITALIANO >>
         DC    CL12'DIECI'         << ITALIANO >>
         DC    CL12'UNDICI'        << ITALIANO >>
         DC    CL12'DODICI'        << ITALIANO >>
         DC    CL12'TREDICI'       << ITALIANO >>
         DC    CL12'QUATTORDICI'   << ITALIANO >>
         DC    CL12'QUINDICI'      << ITALIANO >>
         DC    CL12'SEDICI'        << ITALIANO >>
         DC    CL12'DICIASSETTE'   << ITALIANO >>
         DC    CL12'DICIOTTO'      << ITALIANO >>
         DC    CL12'DICIANNOVE'    << ITALIANO >>
         DC    CL12'VENTI'         << ITALIANO >>
         DC    CL12'VENTUNO'       << ITALIANO >>
         DC    CL12'VEINTIDUE'     << ITALIANO >>
         DC    CL12'VENTITRE'      << ITALIANO >>
         DC    CL12'VENTIQUATTRO'  << ITALIANO >>
         DC    CL12'VENTICINQUE'   << ITALIANO >>
         DC    CL12'VENTISEI'      << ITALIANO >>
         DC    CL12'VENTISETTE'    << ITALIANO >>
         DC    CL12'VENTOTTO'      << ITALIANO >>
         DC    CL12'VENTINOVE'     << ITALIANO >>
         DC    CL12'TRENTA'        << ITALIANO >>
         DC    CL12'TRENTAUNO'     << ITALIANO >>
TBI39S   DC    H'10'               << ITALIANO >>
         DC    CL10'DOMENICA'      << ITALIANO >>
         DC    CL10'LUNEDI'        << ITALIANO >>
         DC    CL10'MARTEDI'       << ITALIANO >>
         DC    CL10'MIERCOLEDI'    << ITALIANO >>
         DC    CL10'GIOVEDI'       << ITALIANO >>
         DC    CL10'VENERDI'       << ITALIANO >>
         DC    CL10'SABATO'        << ITALIANO >>
TBI39C   DC    H'03'               << ITALIANO >>
         DC    CL03'GEN'           << ITALIANO >>
         DC    CL03'FEB'           << ITALIANO >>
         DC    CL03'MAR'           << ITALIANO >>
         DC    CL03'APR'           << ITALIANO >>
         DC    CL03'MAG'           << ITALIANO >>
         DC    CL03'GIU'           << ITALIANO >>
         DC    CL03'LUG'           << ITALIANO >>
         DC    CL03'AUG'           << ITALIANO >>
         DC    CL03'SET'           << ITALIANO >>
         DC    CL03'OTT'           << ITALIANO >>
         DC    CL03'NOV'           << ITALIANO >>
         DC    CL03'DIC'           << ITALIANO >>
TBI39M   DC    H'09'               << ITALIANO >>
         DC    CL09'GENNAIO'       << ITALIANO >>
         DC    CL09'FEBBRAIO'      << ITALIANO >>
         DC    CL09'MARZO'         << ITALIANO >>
         DC    CL09'APRILE'        << ITALIANO >>
         DC    CL09'MAGGIO'        << ITALIANO >>
         DC    CL09'GIUGNO'        << ITALIANO >>
         DC    CL09'LUGLIO'        << ITALIANO >>
         DC    CL09'AUGUST'        << ITALIANO >>
         DC    CL09'SETTEMBRE'     << ITALIANO >>
         DC    CL09'OTTOBRE'       << ITALIANO >>
         DC    CL09'NOVEMBRE'      << ITALIANO >>
         DC    CL09'DICEMBRE'      << ITALIANO >>
*
*  TBI49  ---> ALEMAN
*
TBI49    DS    0F
         DC    A(TBI49D)
         DC    A(TBI49S)
         DC    A(TBI49C)
         DC    A(TBI49M)
TBI49D   DC    H'16'
         DC    CL16'EINS'              << ALEMAN >>
         DC    CL16'ZWEI'              << ALEMAN >>
         DC    CL16'DREI'              << ALEMAN >>
         DC    CL16'VIER'              << ALEMAN >>
         DC    CL16'FUNF'              << ALEMAN >>
         DC    CL16'SECHS'             << ALEMAN >>
         DC    CL16'SIEBEN'            << ALEMAN >>
         DC    CL16'ACHT'              << ALEMAN >>
         DC    CL16'NEUN'              << ALEMAN >>
         DC    CL16'ZEHN'              << ALEMAN >>
         DC    CL16'ELF'               << ALEMAN >>
         DC    CL16'ZWOLF'             << ALEMAN >>
         DC    CL16'DREIZEHN'          << ALEMAN >>
         DC    CL16'VIERZEHN'          << ALEMAN >>
         DC    CL16'FUNFZEHN'          << ALEMAN >>
         DC    CL16'SECHZEHN'          << ALEMAN >>
         DC    CL16'SIEBZEHN'          << ALEMAN >>
         DC    CL16'ACHTZEHN'          << ALEMAN >>
         DC    CL16'NEUNZEHN'          << ALEMAN >>
         DC    CL16'ZWANZIG'           << ALEMAN >>
         DC    CL16'EINUNDZWANZIG'     << ALEMAN >>
         DC    CL16'ZWEIUNDZWANZIG'    << ALEMAN >>
         DC    CL16'DEIUNDZWANZIG'     << ALEMAN >>
         DC    CL16'VIERUNDZWANZIG'    << ALEMAN >>
         DC    CL16'FUNFUNDZWANZIG'    << ALEMAN >>
         DC    CL16'SECHSUNDZWANZIG'   << ALEMAN >>
         DC    CL16'SIEBENUNDZWANZIG'  << ALEMAN >>
         DC    CL16'ACHTUNDZWANZIG'    << ALEMAN >>
         DC    CL16'NEUNUNDZWANZIG'    << ALEMAN >>
         DC    CL16'DREISSIG'          << ALEMAN >>
         DC    CL16'EINUNDREISSIG'     << ALEMAN >>
TBI49S   DC    H'10'                   << ALEMAN >>
         DC    CL10'SONNTAG'           << ALEMAN >>
         DC    CL10'MONTAG'            << ALEMAN >>
         DC    CL10'DIENSTAG'          << ALEMAN >>
         DC    CL10'MITTWOCH'          << ALEMAN >>
         DC    CL10'DONNERSTAG'        << ALEMAN >>
         DC    CL10'FREITAG'           << ALEMAN >>
         DC    CL10'SAMSTAG'           << ALEMAN >>
TBI49C   DC    H'03'                   << ALEMAN >>
         DC    CL03'JAN'               << ALEMAN >>
         DC    CL03'FEB'               << ALEMAN >>
         DC    CL03'MAR'               << ALEMAN >>
         DC    CL03'APR'               << ALEMAN >>
         DC    CL03'MAI'               << ALEMAN >>
         DC    CL03'JUN'               << ALEMAN >>
         DC    CL03'JUL'               << ALEMAN >>
         DC    CL03'AUG'               << ALEMAN >>
         DC    CL03'SEP'               << ALEMAN >>
         DC    CL03'OKT'               << ALEMAN >>
         DC    CL03'NOV'               << ALEMAN >>
         DC    CL03'DEZ'               << ALEMAN >>
TBI49M   DC    H'09'                   << ALEMAN >>
         DC    CL09'JANUAR'            << ALEMAN >>
         DC    CL09'FEBRUAR'           << ALEMAN >>
         DC    CL09'MARZ'              << ALEMAN >>
         DC    CL09'APRIL'             << ALEMAN >>
         DC    CL09'MAI'               << ALEMAN >>
         DC    CL09'JUNI'              << ALEMAN >>
         DC    CL09'JULI'              << ALEMAN >>
         DC    CL09'AUGUST'            << ALEMAN >>
         DC    CL09'SEPTEMBER'         << ALEMAN >>
         DC    CL09'OKTOBER'           << ALEMAN >>
         DC    CL09'NOVEMBER'          << ALEMAN >>
         DC    CL09'DEZEMBER'          << ALEMAN >>
*
*
*  TB351  ---> PORTUGUES
*
TBI351   DS    0F
         DC    A(TBI351D)
         DC    A(TBI351S)
         DC    A(TBI351C)
         DC    A(TBI351M)
TBI351D  DC    H'12'
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
         DC    CL12'....'        << PORTUGUES >>
TBI351S  DC    H'10'             << PORTUGUES >>
         DC    CL10'..NNTAG'     << PORTUGUES >>
         DC    CL10'..NTAG'      << PORTUGUES >>
         DC    CL10'..ENSTAG'    << PORTUGUES >>
         DC    CL10'..TTWOCH'    << PORTUGUES >>
         DC    CL10'..NNERSTAG'  << PORTUGUES >>
         DC    CL10'..EITAG'     << PORTUGUES >>
         DC    CL10'..MSTAG'     << PORTUGUES >>
TBI351C  DC    H'03'             << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
         DC    CL03'...'         << PORTUGUES >>
TBI351M  DC    H'09'             << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
         DC    CL09'...'         << PORTUGUES >>
*
* ---------------------------------------------------------------------
*        RESERVA DE AREAS DINAMICAS
* ---------------------------------------------------------------------
@DYNDAT  DSECT
@TBMES   ORG       *+TBMESESL
@STCKC   ORG       *+MSTCKCL           <> CONVERSION A DECIMAL FECHAS
@CONVT   ORG       *+MCONVTL           <> CONVERSION A BINARIO FECHAS
*
@TIME    ORG       *+TIMEL
*
@TIMEDAT DS        CL16
@CENTURY DS        CL2
@DIASANO DS        PL2                 <> VARIABLE DEVUELTA POR LA
*                                         RUTINA DE ANO BISIESTO
* AREA BASICA DE TRABAJO
*
@AREABAS DC        0CL22
@WGREGO  DS        CL8                 <> GREGORIANA DE TRABAJO
@WJULIA  DS        CL7                 <> JULIANA DE TRABAJO
@WBASE   DS        CL7                 <> BASE DE TRABAJO
*
@SAVABAS DS        CL22                <> SALVADO BASICO
*
@WBASRES DS        PL4                 <> BASE DOMINGO RESURRECCION
@WASTRO  DS        CL11                <> ASTRONOMICA
@WGMT    DS        CL12                <> GMT
@WLOC1PE DS        CL12                <> CAMBIO A VERANO
@WLOC2PE DS        CL12                <> CAMBIO A INVIERNO
@WLOCHPE DS        CL12                <> HORA DEL CAMBIO
@WLOFFSE DS        CL7                 <> GMT
@WFACT   DS        CL9
@WHACT   DS        CL9
@WBISI   DS        CL1                 <> INDICADOR BISIESTO WORK
@WANO    DS        CL4                 <> ANNO DE TRABAJO
@WDIASEN DS        CL1                 <> DIA SEMANA NUMERICO
*
@WDIFER  DS        PL4
@WOFFBAS DS        PL4
@WBAAAA  DS        CL3                 <> UNO MAS PARA PACK
@WBMM    DS        CL1
@WBDD    DS        CL1
@WBSS    DS        CL1
@ACUMUL  DS        D
@WORKD   DS        D
@WORKDA  DS        D                   <> INTERMEDIATE ANSWER
@WORKDB  DS        D                   <> INTERMEDIATE ANSWER
@WORKDC  DS        D                   <> INTERMEDIATE ANSWER
@WORKDX  DS        D                   <> INTERMEDIATE ANSWER
@WORKDM  DS        D
@WORKDD  DS        D
@WORKDY  DS        D
@WORKF   DS        F
@WORKH   DS        H
@WORKANO DS        PL3
@WORK15  DS        CL15
@WGMES   DS        PL2                 <> GREGORIAN @WGMES
@WGDIA   DS        PL2                 <> GREGORIAN @WGDIA
@WGANO   DS        PL4                 <> GREGORIAN @WGANO
*
@ADRIDIO DS        F                   <> ADDR.CALCULADA IDIOMA
*
@CENTPAK DS        PL2
@WKP5    DS        PL5
@WKP4    DS        PL4
@WKP3    DS        PL3
@WKZ3    DS        ZL3
@WKT2    DS        PL2
@WKT3    DS        PL1
@WKNONL  DS        PL2
@WKMET   DS        PL2
@WKMETC  DS        PL2
@WKEPACT DS        PL2
@WKDAY   DS        PL2
@WKDMOD  DS        PL3
@WEASTER DS        CL8     >>ATENCION    MMDDAAAA
*
@TIMEOFF DS        2D                  <> OFFSET DEC FECHAS
@TIMELOC DS        2D                  <> DATE-TIME DEC LOCAL
@TIMEGMT DS        2D                  <> DATE-TIME DEC GMT
*
@GMTSTAM DS        CL20
@LOCSTAM DS        CL20
*
@CANAREA ORG       *+$CANLENG          <> AREA LLANADA MDCANTI
*
*        SE CONSIGNA LA ZONA DE SAVE'S AL FINAL PARA
*        GARANTIZAR EL ALINEAMIENTO A DOBLE PALABRA
*
*        ATENCION A LA INSTRUCCION ORG DE POSICIONAMIENTO
*        QUE TIENE DELANTE PARA FORZAR SU COLOCACION AL FINAL
*        DEL AREA SUMINISTRADA POR EL PROGRAMA LLAMADOR
*
         ORG       @DYNDAT+1024-@DYNSAVL
*
@DYNSAV  DS        18D                 <> PREVISION EN CASO DIR.64
@DYNSAVL EQU       *-@DYNSAV           <> PREVISION EN CASO DIR.64
*
@DYNDATL EQU   *-@DYNDAT
* ---------------------------------------------------------------------
*        DSECT ARAMETROS LLAMADA MDCANTI
* ---------------------------------------------------------------------
$CANPARM DSECT
$CANCOD  DS        H                   <> CODIGOS DE LLAMADA
*                                         0   FEMENINO
*                                         1   MASCULINO
$CANPENT DS        CL18                <> PARTE ENTERA A CONVERTIR
$CANPDEC DS        CL2                 <> PARTE DECIMAL
$CANTROC DS        CL6
$CANLITE DS        CL80                <> LITERAL DEVUELTO
*
$CANLENG EQU       *-$CANPARM
* ---------------------------------------------------------------------
*        DSECT DE PARAMETROS  CON CODIGOS DE LLAMADA/RETORNO
* ---------------------------------------------------------------------
$PARAM   DSECT
$CODIGO DS         H         <> CODIGOS DE LLAMADA
*                                0   FECHA DEL DIA LOCAL Y TIMESTAMP
*                                1   VERIFICACION ANO BISIESTO      (1)
*                                2   OBTENER FECHAS RELIGIOSAS      (1)
*                                3   FECHA GMT Y TIMESTAMP GMT
*                                --> CONVERSIONES / VERIFICACIONES
*                                4   -GREGORIANA
*                                5   -JULIANA
*                                6   -BASE
*                                7   -BASE SIGLO XX
*                                8   -BASE SIGLO XXI
*                                9   -ASTRONOMICA
*                               10   -LILIANA
*                               11   -GMT (NECESITA HH:MM)          (1)
*                               12   -DIFERENCIAS ENTRE DOS GREGORI.(1)
*
* (1) ESTAS FUNCIONES DEVUELVEN CONTROL DIRECTO AL PROGRAMA
*     LLAMANTE. NO ES POSIBLE OBTENER OTRAS FECHAS Y/O EDICIONES.
*     PARA HACERLO SERA NECESARIO LLAMAR AL MODULO DE NUEVO Y UTILIZAR
*     EL CODIGO DE LLAMAD QUE SE DESEE.
*
*                            <> CODIGOS DE RETORNO
*                               0   FUNCION TERMINADA CORRECTAMENTE
*                              -1   CODIGO DE LLAMADA ERRONEO
*                              -2   FECHA(S) INVALIDA(S) O ILOGICA(S)
*                              -3   PETICION INVALIDA FECHAS RELIGIOSAS
*                              -4   NO PODEMOS DETECTAR OFFSET BASICO
*                                   DE LA HORA LOCAL POR ESTAR EN LA
*                                   HORA EN LA QUE SE PRODUCE EL CAMBIO
*                                   Y NO SE HA ESTABLECIDO VALOR POR
*                                   DEFECTO EN LA INSTALACION.
*
$SAVESTA DS        CL1024    <> AREA TRABAJO FACILITADA PGM LLAMADOR
*
$OBTIPOS DS        0CL16     <> MARCAS DATOS OBTENER
$OB@BISI DS        CL1       <> - BISIESTO
$OB@RELI DS        CL1       <> - RELIGIOSAS DE ESE ANO
$OB@GREG DS        CL1       <> - GREGORIANA
$OB@JULI DS        CL1       <> - JULIANA
* --
$OB@BASE DS        CL1       <> - BASE
$OB@BAS0 DS        CL1       <> - BASE SIGLO XX
$OB@BAS1 DS        CL1       <> - BASE SIGLO XXI
$OB@LILI DS        CL1       <> - LILIANA
* --
$OB@ASTR DS        CL1       <> - ASTRONOMICA
$OB@EDT  DS        CL1       <> - EDICIONES
         DS        CL1       <> - RESERVADO - 1
         DS        CL1       <> - RESERVADO - 2
* --
         DS        CL1       <> - RESERVADO - 3
         DS        CL1       <> - RESERVADO - 4
$OB@EDTH DS        CL1       <> - EDICION-S LITERAL ANO            (2)
$OB@EDTA DS        CL1       <> - EDICION-S LITERAL HORA           (2)
*
* (2) ESTAS FUNCIONES SOLO SON POSIBLES EN IDIOMA CASTELLANO
*     AUNQUE SE HAYA SOLICITADO OTRO IDIOMA SE DEVOLVERAN EN CASTELLANO
*     POR OTRO LADO, CONSUMEN TIEMPO Y RECURSOS, YA QUE ES NECESARIA
*     UNA LLAMADA EXTERNA A OTRO MODULO, VARIAS VECES, PARA
*     CONFECCIONAR LOS LITERALES.
*
         ORG       $OBTIPOS+16
*
$ANNO    DS        CL04'AAAA'          <> ANO (ALGUNAS FUNCIONES)
$FEGREGO DS        CL08'AAAAMMDD'      <> GREGORIANA
$FEJULIA DS        CL07'AAAADDD'       <> JULIANA
$FEBASE  DS        CL07'NNNNNNN'       <> BASE TOTAL DESDE 01-01-0001
$FEBAS20 DS        CL07'NNNNNNN'       <> BASE SIGLO XX
$FEBAS21 DS        CL07'NNNNNNN'       <> BASE SIGLO XXI
$FELILIA DS        CL07'NNNNNNN'       <> LILIANA
$FEGMT   DS        CL12'AAAAMMDDHHMM'  <> GMT (VER CONSIDERACIONES)
$FEASTRO DS        CL11'NNNNNNNDDDD'   <> ASTRONOMICA
$FEGREG2 DS        CL08'AAAAMMDD'      <> GREGORIANA-2
$FEDIFER DS        CL04'BBBB'          <> DIFERENCIA BINARIA CON SIGNO
$ERACRIS DS        CL02'AC'            <> ERA (ALGUNAS FUNCIONES)
*                                          DC/ESPAC.=DESPUES DE CRISTO
*                                          AC       =ANTES DE CRISTO
$HORAFUL DS        0CL8'HHMMSSDD'      <> HORA COMPLETA
$HORA    DS        CL02'XX'            <> HORA
$MINUTO  DS        CL02'XX'            <> MINUTO
$SEGUNDO DS        CL02'XX'            <> SEGUNDO
$DECIMAS DS        CL02'XX'            <> DECIMAS DE SEGUNDO
*
$IDIOMA  DS        CL4'XXXX'           <> CODIGOS DE IDIOMA
*                                         341 ---> CASTELLANO
*                                         343 ---> CATALAN------- FALTA
*                                         346 ---> VASCO--------- FALTA
*                                         3481 --> GALLEGO------- FALTA
*                                         33 ----> FRANCES
*                                         351 ---> PORTUGUES----- FALTA
*                                         39 ----> ITALIANO
*                                         44 ----> INGLES
*                                         49 ----> ALEMAN
*
$INDBISI DS        CL01                <> BISIESTO (S / N)
$TIMESTA DS        CL20                <> TIMESTAMP
$LOFFSET DS        CL7                 <> LOCAL OFFSET
*
$DIANUM  DS        CL2                 <> DIA NUMERICO
$DIAALF  DS        CL20                <> DIA ALFABETICO
$MESNUM  DS        CL2                 <> MES NUMERICO
$MESALF  DS        CL20                <> MES ALFABETICO
$ANONUM  DS        CL4                 <> ANO NUMERICO (SI MARCA EXPL.)
$ANOALF  DS        CL40                <> ANO ALFABETICO (SI MARCA EX.)
$DIASEN  DS        CL1                 <> DIA SEMANA NUM.(0=DOMINGO)
$DIASEA  DS        CL15                <> DIA DE LA SEMANA
*
$FEEDT1  DS        CL11'DD.MMM.AAAA'
$FEEDT2  DS        CL09'DD.MMM.AA'
$FEEDT3  DS        CL10'DD.MM.AAAA'
$FEEDT4  DS        CL08'DD.MM.AA'
*
$HOREDT  DS        CL11'HH:MM:SS:DD'
$HORBIN  DS        CL6                 <> HEXADECIMAL SIN SIGNO
$HORALF  DS        CL80                <> HORA ALFAB (SI MARCA EXPL.)
*
*        FECHAS RELIGIOSAS (EN FORMATO GREGORIANO)
*
$MICENIZ DS        CL8'AAAAMMDD'       <> MIERCOLES DE CENIZA (GREGOR.)
$VIERNST DS        CL8'AAAAMMDD'       <> VIERNES SANTO       (GREGOR.)
$RESURRE DS        CL8'AAAAMMDD'       <> RESURRECCION        (GREGOR.)
$ASCENSI DS        CL8'AAAAMMDD'       <> ASCENSION           (GREGOR.)
$PENTECO DS        CL8'AAAAMMDD'       <> PENTECOSTES         (GREGOR.)
$CORPUSC DS        CL8'AAAAMMDD'       <> CORPUS CHRISTY      (GREGOR.)
*
         CVT   DSECT=YES,LIST=NO
*
         END
